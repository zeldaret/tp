//
// Generated By: dol2asm
// Translation Unit: J2DAnimation
//

#include "JSystem/J2DGraph/J2DAnimation.h"
#include "JSystem/J2DGraph/J2DScreen.h"
#include "JSystem/J3DGraphBase/J3DTransform.h"
#include "JSystem/JUtility/JUTResource.h"
#include "dol2asm.h"
#include "dolphin/types.h"

f32 J2DGetKeyFrameInterpolationf(f32 param_0, J3DAnmKeyTableBase* param_1, f32* param_2);
f32 J2DGetKeyFrameInterpolations(f32 param_0, J3DAnmKeyTableBase* param_1, s16* param_2);

//
// Declarations:
//

/* 8030A590-8030AAFC 304ED0 056C+00 1/0 0/0 0/0 .text
 * getTransform__19J2DAnmTransformFullCFUsP16J3DTransformInfo   */
void J2DAnmTransformFull::getTransform(u16 param_0, J3DTransformInfo* transformInfo) const {
    u16 idx = (param_0 * 3);
    UnkAnimInfo* xPart = &field_0x24[idx];
    UnkAnimInfo* yPart = &field_0x24[idx + 1];
    UnkAnimInfo* zPart = &field_0x24[idx + 2];
    u16 xMaxFrame = xPart->_0;
    if (getFrame() < 0) {
        transformInfo->mScale.x = field_0x10[xPart->_2];
    } else if (getFrame() >= xMaxFrame) {
        transformInfo->mScale.x = field_0x10[(xPart->_2 + (xMaxFrame - 1))];
    } else {
        transformInfo->mScale.x = field_0x10[(xPart->_2 + (int)getFrame())];
    }
    u16 yMaxFrame = yPart->_0;
    if (getFrame() < 0) {
        transformInfo->mScale.y = field_0x10[yPart->_2];
    } else if (getFrame() >= yMaxFrame) {
        transformInfo->mScale.y = field_0x10[(yPart->_2 + (yMaxFrame - 1))];
    } else {
        transformInfo->mScale.y = field_0x10[(yPart->_2 + (int)getFrame())];
    }
    u16 zMaxFrame = zPart->_0;
    if (getFrame() < 0) {
        transformInfo->mScale.z = field_0x10[zPart->_2];
    } else if (getFrame() >= zMaxFrame) {
        transformInfo->mScale.z = field_0x10[(zPart->_2 + (zMaxFrame - 1))];
    } else {
        transformInfo->mScale.z = field_0x10[(zPart->_2 + (int)getFrame())];
    }
    xMaxFrame = xPart->_4;
    if (getFrame() < 0) {
        transformInfo->mRotation.x = field_0x14[xPart->_6];
    } else if (getFrame() >= xMaxFrame) {
        transformInfo->mRotation.x = field_0x14[(xPart->_6 + (xMaxFrame - 1))];
    } else {
        transformInfo->mRotation.x = field_0x14[(xPart->_6 + (int)getFrame())];
    }
    yMaxFrame = yPart->_4;
    if (getFrame() < 0) {
        transformInfo->mRotation.y = field_0x14[yPart->_6];
    } else if (getFrame() >= yMaxFrame) {
        transformInfo->mRotation.y = field_0x14[(yPart->_6 + (yMaxFrame - 1))];
    } else {
        transformInfo->mRotation.y = field_0x14[(yPart->_6 + (int)getFrame())];
    }
    zMaxFrame = zPart->_4;
    if (getFrame() < 0) {
        transformInfo->mRotation.z = field_0x14[zPart->_6];
    } else if (getFrame() >= zMaxFrame) {
        transformInfo->mRotation.z = field_0x14[(zPart->_6 + (zMaxFrame - 1))];
    } else {
        transformInfo->mRotation.z = field_0x14[(zPart->_6 + (int)getFrame())];
    }
    xMaxFrame = xPart->_8;
    if (getFrame() < 0) {
        transformInfo->mTranslate.x = field_0x18[xPart->_A];
    } else if (getFrame() >= xMaxFrame) {
        transformInfo->mTranslate.x = field_0x18[(xPart->_A + (xMaxFrame - 1))];
    } else {
        transformInfo->mTranslate.x = field_0x18[(xPart->_A + (int)getFrame())];
    }
    yMaxFrame = yPart->_8;
    if (getFrame() < 0) {
        transformInfo->mTranslate.y = field_0x18[yPart->_A];
    } else if (getFrame() >= yMaxFrame) {
        transformInfo->mTranslate.y = field_0x18[(yPart->_A + (yMaxFrame - 1))];
    } else {
        transformInfo->mTranslate.y = field_0x18[(yPart->_A + (int)getFrame())];
    }
    zMaxFrame = zPart->_8;
    if (getFrame() < 0) {
        transformInfo->mTranslate.z = field_0x18[zPart->_A];
    } else if (getFrame() >= zMaxFrame) {
        transformInfo->mTranslate.z = field_0x18[(zPart->_A + (zMaxFrame - 1))];
    } else {
        transformInfo->mTranslate.z = field_0x18[(zPart->_A + (int)getFrame())];
    }
}

/* 8030AAFC-8030AF24 30543C 0428+00 1/0 0/0 0/0 .text
 * calcTransform__18J2DAnmTransformKeyCFfUsP16J3DTransformInfo  */
void J2DAnmTransformKey::calcTransform(f32 param_0, u16 param_1,
                                       J3DTransformInfo* transformInfo) const {
    u16 idx = param_1 * 3;
    UnkKeyAnmStruct* xInf = &field_0x28[idx];
    UnkKeyAnmStruct* yInf = &field_0x28[idx + 1];
    UnkKeyAnmStruct* zInf = &field_0x28[idx + 2];
    switch (xInf->_0._0) {
    case 0:
        transformInfo->mScale.x = 1;
        break;
    case 1:
        transformInfo->mScale.x = field_0x10[xInf->_0._2];
        break;
    default:
        transformInfo->mScale.x =
            J2DGetKeyFrameInterpolationf(param_0, &xInf->_0, &field_0x10[xInf->_0._2]);
    }
    switch (yInf->_0._0) {
    case 0:
        transformInfo->mScale.y = 1;
        break;
    case 1:
        transformInfo->mScale.y = field_0x10[yInf->_0._2];
        break;
    default:
        transformInfo->mScale.y =
            J2DGetKeyFrameInterpolationf(param_0, &yInf->_0, &field_0x10[yInf->_0._2]);
    }
    switch (zInf->_0._0) {
    case 0:
        transformInfo->mScale.z = 1;
        break;
    case 1:
        transformInfo->mScale.z = field_0x10[zInf->_0._2];
        break;
    default:
        transformInfo->mScale.z =
            J2DGetKeyFrameInterpolationf(param_0, &zInf->_0, &field_0x10[zInf->_0._2]);
    }
    switch (xInf->_6._0) {
    case 0:
        transformInfo->mRotation.x = 0;
        break;
    case 1:
        transformInfo->mRotation.x = field_0x14[xInf->_6._2] << field_0x24;
        break;
    default:
        transformInfo->mRotation.x = static_cast<s32>(J2DGetKeyFrameInterpolations(
                                         param_0, &xInf->_6, &field_0x14[xInf->_6._2]))
                                     << field_0x24;
    }
    switch (yInf->_6._0) {
    case 0:
        transformInfo->mRotation.y = 0;
        break;
    case 1:
        transformInfo->mRotation.y = field_0x14[yInf->_6._2] << field_0x24;
        break;
    default:
        transformInfo->mRotation.y = static_cast<s32>(J2DGetKeyFrameInterpolations(
                                         param_0, &yInf->_6, &field_0x14[yInf->_6._2]))
                                     << field_0x24;
    }
    switch (zInf->_6._0) {
    case 0:
        transformInfo->mRotation.z = 0;
        break;
    case 1:
        transformInfo->mRotation.z = field_0x14[zInf->_6._2] << field_0x24;
        break;
    default:
        transformInfo->mRotation.z = static_cast<s32>(J2DGetKeyFrameInterpolations(
                                         param_0, &zInf->_6, &field_0x14[zInf->_6._2]))
                                     << field_0x24;
    }
    switch (xInf->_C._0) {
    case 0:
        transformInfo->mTranslate.x = 0;
        break;
    case 1:
        transformInfo->mTranslate.x = field_0x18[xInf->_C._2];
        break;
    default:
        transformInfo->mTranslate.x =
            J2DGetKeyFrameInterpolationf(param_0, &xInf->_C, &field_0x18[xInf->_C._2]);
    }
    switch (yInf->_C._0) {
    case 0:
        transformInfo->mTranslate.y = 0;
        break;
    case 1:
        transformInfo->mTranslate.y = field_0x18[yInf->_C._2];
        break;
    default:
        transformInfo->mTranslate.y =
            J2DGetKeyFrameInterpolationf(param_0, &yInf->_C, &field_0x18[yInf->_C._2]);
    }
    switch (zInf->_C._0) {
    case 0:
        transformInfo->mTranslate.z = 0;
        break;
    case 1:
        transformInfo->mTranslate.z = field_0x18[zInf->_C._2];
        break;
    default:
        transformInfo->mTranslate.z =
            J2DGetKeyFrameInterpolationf(param_0, &zInf->_C, &field_0x18[zInf->_C._2]);
    }
}

/* 8030AF24-8030AFC8 305864 00A4+00 3/0 0/0 0/0 .text
 * searchUpdateMaterialID__11J2DAnmColorFP9J2DScreen            */
void J2DAnmColor::searchUpdateMaterialID(J2DScreen* pScreen) {
    if (pScreen != NULL && pScreen->mNameTable != NULL) {
        for (u16 entry = 0; entry < this->getUpdateMaterialNum(); entry++) {
            s32 idx = pScreen->mNameTable->getIndex(this->field_0x20.getName(entry));
            if (idx != -1) {
                mUpdateMaterialID[entry] = idx;
            } else {
                mUpdateMaterialID[entry] = 0xFFFF;
            }
        }
    }
}

/* 8030AFC8-8030B200 305908 0238+00 1/0 0/0 0/0 .text getColor__15J2DAnmColorFullCFUsP8_GXColor */
void J2DAnmColorFull::getColor(u16 param_0, _GXColor* pColor) const {
    UnkAnmColorStruct* info = &field_0x40[param_0];
    u16 maxFrame = info->_0;
    if (getFrame() < 0) {
        pColor->r = field_0x30[info->_2];
    } else if (getFrame() >= maxFrame) {
        pColor->r = field_0x30[info->_2 + (maxFrame - 1)];
    } else {
        pColor->r = field_0x30[info->_2 + (int)getFrame()];
    }
    maxFrame = info->_4;
    if (getFrame() < 0) {
        pColor->g = field_0x34[info->_6];
    } else if (getFrame() >= maxFrame) {
        pColor->g = field_0x34[info->_6 + (maxFrame - 1)];
    } else {
        pColor->g = field_0x34[info->_6 + (int)getFrame()];
    }
    maxFrame = info->_8;
    if (getFrame() < 0) {
        pColor->b = field_0x38[info->_A];
    } else if (getFrame() >= maxFrame) {
        pColor->b = field_0x38[info->_A + (maxFrame - 1)];
    } else {
        pColor->b = field_0x38[info->_A + (int)getFrame()];
    }
    maxFrame = info->_C;
    if (getFrame() < 0) {
        pColor->a = field_0x3c[info->_E];
    } else if (getFrame() >= maxFrame) {
        pColor->a = field_0x3c[info->_E + (maxFrame - 1)];
    } else {
        pColor->a = field_0x3c[info->_E + (int)getFrame()];
    }
}

/* 8030B200-8030B4C4 305B40 02C4+00 1/0 0/0 0/0 .text getColor__14J2DAnmColorKeyCFUsP8_GXColor */
void J2DAnmColorKey::getColor(u16 param_0, _GXColor* pColor) const {
    UnkKeyColorAnmStruct* info = &field_0x40[param_0];
    f32 val;
    switch (info->_0._0) {
    case 0:
        pColor->r = 0;
        break;
    case 1:
        pColor->r = field_0x30[info->_0._2];
        break;
    default:
        val = J2DGetKeyFrameInterpolations(getFrame(), &info->_0, &field_0x30[info->_0._2]);
        if (val < 0) {
            pColor->r = 0;
        } else if (val > 255) {
            pColor->r = 255;
        } else {
            OSf32tou8(&val, &pColor->r);
        }
    }
    switch (info->_6._0) {
    case 0:
        pColor->g = 0;
        break;
    case 1:
        pColor->g = field_0x34[info->_6._2];
        break;
    default:
        val = J2DGetKeyFrameInterpolations(getFrame(), &info->_6, &field_0x34[info->_6._2]);
        if (val < 0) {
            pColor->g = 0;
        } else if (val > 255) {
            pColor->g = 255;
        } else {
            OSf32tou8(&val, &pColor->g);
        }
    }
    switch (info->_C._0) {
    case 0:
        pColor->b = 0;
        break;
    case 1:
        pColor->b = field_0x38[info->_C._2];
        break;
    default:
        val = J2DGetKeyFrameInterpolations(getFrame(), &info->_C, &field_0x38[info->_C._2]);
        if (val < 0) {
            pColor->b = 0;
        } else if (val > 255) {
            pColor->b = 255;
        } else {
            OSf32tou8(&val, &pColor->b);
        }
    }
    switch (info->_12._0) {
    case 0:
        pColor->a = 0;
        break;
    case 1:
        pColor->a = field_0x3c[info->_12._2];
        break;
    default:
        val = J2DGetKeyFrameInterpolations(getFrame(), &info->_12, &field_0x3c[info->_12._2]);
        if (val < 0) {
            pColor->a = 0;
        } else if (val > 255) {
            pColor->a = 255;
        } else {
            OSf32tou8(&val, &pColor->a);
        }
    }
}

/* 8030B4C4-8030B704 305E04 0240+00 1/0 0/0 0/0 .text
 * getColor__18J2DAnmVtxColorFullCFUcUsP8_GXColor               */
void J2DAnmVtxColorFull::getColor(u8 param_0, u16 param_1, _GXColor* pColor) const {
    UnkAnmColorStruct* info = &field_0x24[param_0][param_1];
    u16 maxFrame = info->_0;
    if (getFrame() < 0) {
        pColor->r = field_0x2c[info->_2];
    } else if (getFrame() >= maxFrame) {
        pColor->r = field_0x2c[info->_2 + (maxFrame - 1)];
    } else {
        pColor->r = field_0x2c[info->_2 + (int)getFrame()];
    }
    maxFrame = info->_4;
    if (getFrame() < 0) {
        pColor->g = field_0x30[info->_6];
    } else if (getFrame() >= maxFrame) {
        pColor->g = field_0x30[info->_6 + (maxFrame - 1)];
    } else {
        pColor->g = field_0x30[info->_6 + (int)getFrame()];
    }
    maxFrame = info->_8;
    if (getFrame() < 0) {
        pColor->b = field_0x34[info->_A];
    } else if (getFrame() >= maxFrame) {
        pColor->b = field_0x34[info->_A + (maxFrame - 1)];
    } else {
        pColor->b = field_0x34[info->_A + (int)getFrame()];
    }
    maxFrame = info->_C;
    if (getFrame() < 0) {
        pColor->a = field_0x38[info->_E];
    } else if (getFrame() >= maxFrame) {
        pColor->a = field_0x38[info->_E + (maxFrame - 1)];
    } else {
        pColor->a = field_0x38[info->_E + (int)getFrame()];
    }
}

/* 8030B704-8030B9F0 306044 02EC+00 1/0 0/0 0/0 .text
 * getColor__17J2DAnmVtxColorKeyCFUcUsP8_GXColor                */
void J2DAnmVtxColorKey::getColor(u8 param_0, u16 param_1, _GXColor* pColor) const {
    UnkKeyColorAnmStruct* info = &field_0x24[param_0][param_1];
    f32 val;
    switch (info->_0._0) {
    case 0:
        pColor->r = 0;
        break;
    case 1:
        pColor->r = field_0x2c[info->_0._2];
        break;
    default:
        val = J2DGetKeyFrameInterpolations(getFrame(), &info->_0, &field_0x2c[info->_0._2]);
        if ((val <= 0)) {
            pColor->r = 0;
        } else if (val <= 255) {
            OSf32tou8(&val, &pColor->r);
        } else {
            pColor->r = 255;
        }
    }
    switch (info->_6._0) {
    case 0:
        pColor->g = 0;
        break;
    case 1:
        pColor->g = field_0x30[info->_6._2];
        break;
    default:
        val = J2DGetKeyFrameInterpolations(getFrame(), &info->_6, &field_0x30[info->_6._2]);
        if (val <= 0) {
            pColor->g = 0;
        } else if (val <= 255) {
            OSf32tou8(&val, &pColor->g);
        } else {
            pColor->g = 255;
        }
    }
    switch (info->_C._0) {
    case 0:
        pColor->b = 0;
        break;
    case 1:
        pColor->b = field_0x34[info->_C._2];
        break;
    default:
        val = J2DGetKeyFrameInterpolations(getFrame(), &info->_C, &field_0x34[info->_C._2]);
        if (val <= 0) {
            pColor->b = 0;
        } else if (val <= 255) {
            OSf32tou8(&val, &pColor->b);
        } else {
            pColor->b = 255;
        }
    }
    switch (info->_12._0) {
    case 0:
        pColor->a = 0;
        break;
    case 1:
        pColor->a = field_0x38[info->_12._2];
        break;
    default:
        val = J2DGetKeyFrameInterpolations(getFrame(), &info->_12, &field_0x38[info->_12._2]);
        if (val <= 0) {
            pColor->a = 0;
        } else if (val <= 255) {
            OSf32tou8(&val, &pColor->a);
        } else {
            pColor->a = 255;
        }
    }
}

/* 8030B9F0-8030BC60 306330 0270+00 0/0 1/1 0/0 .text
 * calcTransform__19J2DAnmTextureSRTKeyCFfUsP17J3DTextureSRTInfo */
void J2DAnmTextureSRTKey::calcTransform(f32 param_0, u16 param_1, J3DTextureSRTInfo* pInfo) const {
    u16 idx = param_1 * 3;
    UnkKeyAnmStruct* xInf = &field_0x14[idx];
    UnkKeyAnmStruct* yInf = &field_0x14[idx + 1];
    UnkKeyAnmStruct* zInf = &field_0x14[idx + 2];
    switch (xInf->_0._0) {
    case 0:
        pInfo->mScaleX = 1;
        break;
    case 1:
        pInfo->mScaleX = field_0x20[xInf->_0._2];
        break;
    default:
        pInfo->mScaleX = J2DGetKeyFrameInterpolationf(param_0, &xInf->_0, &field_0x20[xInf->_0._2]);
    }
    switch (yInf->_0._0) {
    case 0:
        pInfo->mScaleY = 1;
        break;
    case 1:
        pInfo->mScaleY = field_0x20[yInf->_0._2];
        break;
    default:
        pInfo->mScaleY = J2DGetKeyFrameInterpolationf(param_0, &yInf->_0, &field_0x20[yInf->_0._2]);
    }
    switch (zInf->_6._0) {
    case 0:
        pInfo->mRotation = 0;
        break;
    case 1:
        pInfo->mRotation = field_0x24[zInf->_6._2] << field_0x10;
        break;
    default:
        pInfo->mRotation = static_cast<s32>(J2DGetKeyFrameInterpolations(param_0, &zInf->_6,
                                                                         &field_0x24[zInf->_6._2]))
                           << field_0x10;
    }
    switch (xInf->_C._0) {
    case 0:
        pInfo->mTranslationX = 0;
        break;
    case 1:
        pInfo->mTranslationX = field_0x28[xInf->_C._2];
        break;
    default:
        pInfo->mTranslationX =
            J2DGetKeyFrameInterpolationf(param_0, &xInf->_C, &field_0x28[xInf->_C._2]);
    }
    switch (yInf->_C._0) {
    case 0:
        pInfo->mTranslationY = 0;
        break;
    case 1:
        pInfo->mTranslationY = field_0x28[yInf->_C._2];
        break;
    default:
        pInfo->mTranslationY =
            J2DGetKeyFrameInterpolationf(param_0, &yInf->_C, &field_0x28[yInf->_C._2]);
    }
}

/* 8030BC60-8030BD10 3065A0 00B0+00 1/0 0/0 0/0 .text
 * searchUpdateMaterialID__19J2DAnmTextureSRTKeyFP9J2DScreen    */
void J2DAnmTextureSRTKey::searchUpdateMaterialID(J2DScreen* pScreen) {
    if (pScreen != NULL && pScreen->mNameTable != NULL) {
        for (u16 entry = 0; entry < this->getUpdateMaterialNum(); entry++) {
            s32 idx = pScreen->mNameTable->getIndex(field_0x34.getName(entry));
            if (idx != -1) {
                mUpdateMaterialID[entry] = idx;
            } else {
                mUpdateMaterialID[entry] = 0xFFFF;
            }
        }
    }
}

/* 8030BD10-8030BEE8 306650 01D8+00 1/0 0/0 0/0 .text
 * searchUpdateMaterialID__16J2DAnmTexPatternFP9J2DScreen       */
void J2DAnmTexPattern::searchUpdateMaterialID(J2DScreen* pScreen) {
    if (pScreen != NULL && pScreen->mNameTable != NULL && pScreen->field_0x108 != NULL) {
        for (u16 entry = 0; entry < this->getUpdateMaterialNum(); entry++) {
            s32 idx = pScreen->mNameTable->getIndex(field_0x20.getName(entry));
            if (idx != -1) {
                mUpdaterMaterialID[entry] = idx;
            } else {
                mUpdaterMaterialID[entry] = 0xFFFF;
            }
        }
        delete[] mTIMGPtrArray;
        mTIMGPtrArray = new J2DAnmTexPatternTIMGPointer[pScreen->field_0x108->mCount];
        if (mTIMGPtrArray != NULL) {
            JUTResReference resRef;
            for (u16 i = 0; i < pScreen->field_0x108->mCount; i++) {
                s8* var1 = pScreen->field_0x108->getResReference(i);
                ResTIMG* var2 = NULL;
                if (var1 != NULL) {
                    var2 = (ResTIMG*)resRef.getResource(var1, 'TIMG', NULL);
                    if (var2 == NULL && J2DScreen::getDataManage() != NULL) {
                        var2 = (ResTIMG*)J2DScreen::getDataManage()->get(
                            pScreen->field_0x108->getName(i));
                    }
                }
                mTIMGPtrArray[i].mRes = var2;
                if (var2 != NULL && var2->palettesEnabled) {
                    JUTPalette* palette =
                        new JUTPalette(GX_TLUT0, (_GXTlutFmt)var2->paletteFormat,
                                       (JUTTransparency)var2->alphaEnabled, var2->paletteCount,
                                       ((u8*)var2) + var2->paletteOffset);
                    mTIMGPtrArray[i].mPalette = palette;
                }
            }
        }
    }
}

/* 8030BEE8-8030BF9C 306828 00B4+00 2/2 1/1 0/0 .text            getTexNo__16J2DAnmTexPatternCFUsPUs
 */
void J2DAnmTexPattern::getTexNo(u16 param_0, u16* pTexNo) const {
    u16 maxFrame = mAnmTable[param_0]._0;
    f32 frame = getFrame();
    if (frame < 0) {
        *pTexNo = field_0x10[mAnmTable[param_0]._2];
    } else if (frame >= maxFrame) {
        *pTexNo = field_0x10[mAnmTable[param_0]._2 + (maxFrame - 1)];
    } else {
        *pTexNo = field_0x10[mAnmTable[param_0]._2 + (int)frame];
    }
}

/* 8030BF9C-8030BFF0 3068DC 0054+00 0/0 1/1 0/0 .text            getResTIMG__16J2DAnmTexPatternCFUs
 */
ResTIMG* J2DAnmTexPattern::getResTIMG(u16 param_0) const {
    if (mTIMGPtrArray == NULL) {
        return NULL;
    } else {
        u16 texNo;
        this->getTexNo(param_0, &texNo);
        return mTIMGPtrArray[texNo].mRes;
    }
}

/* 8030BFF0-8030C048 306930 0058+00 0/0 1/1 0/0 .text            getPalette__16J2DAnmTexPatternCFUs
 */
JUTPalette* J2DAnmTexPattern::getPalette(u16 param_0) const {
    if (mTIMGPtrArray == NULL) {
        return NULL;
    } else {
        u16 texNo;
        this->getTexNo(param_0, &texNo);
        return mTIMGPtrArray[texNo].mPalette;
    }
}

/* 8030C048-8030C0F0 306988 00A8+00 0/0 3/3 0/0 .text getVisibility__20J2DAnmVisibilityFullCFUsPUc
 */
void J2DAnmVisibilityFull::getVisibility(u16 param_0, u8* param_1) const {
    u16 maxFrame = field_0x14[param_0]._0;
    if (getFrame() < 0) {
        *param_1 = field_0x18[field_0x14[param_0]._2];
    } else if (getFrame() >= maxFrame) {
        *param_1 = field_0x18[field_0x14[param_0]._2 + (maxFrame - 1)];
    } else {
        int frame = getFrame();
        *param_1 = field_0x18[field_0x14[param_0]._2 + frame];
    }
}

/* 8030C0F0-8030C3B4 306A30 02C4+00 0/0 1/1 0/0 .text
 * getTevColorReg__15J2DAnmTevRegKeyCFUsP11_GXColorS10          */
void J2DAnmTevRegKey::getTevColorReg(u16 param_0, _GXColorS10* param_1) const {
    J2DAnmTevRegKeyData* info = &mAnmCRegKeyTable[param_0];
    f32 val;
    switch (info->_0._0) {
    case 0:
        param_1->r = 0;
        break;
    case 1:
        param_1->r = field_0x54[info->_0._2];
        break;
    default:
        val = J2DGetKeyFrameInterpolations(getFrame(), &info->_0, &field_0x54[info->_0._2]);
        if (val < -0x400) {
            param_1->r = -0x400;
        } else if (val > 0x3FF) {
            param_1->r = 0x3FF;
        } else {
            OSf32tos16(&val, &param_1->r);
        }
    }
    switch (info->_6._0) {
    case 0:
        param_1->g = 0;
        break;
    case 1:
        param_1->g = field_0x58[info->_6._2];
        break;
    default:
        val = J2DGetKeyFrameInterpolations(getFrame(), &info->_6, &field_0x58[info->_6._2]);
        if (val < -0x400) {
            param_1->g = -0x400;
        } else if (val > 0x3FF) {
            param_1->g = 0x3FF;
        } else {
            OSf32tos16(&val, &param_1->g);
        }
    }
    switch (info->_C._0) {
    case 0:
        param_1->b = 0;
        break;
    case 1:
        param_1->b = field_0x5c[info->_C._2];
        break;
    default:
        val = J2DGetKeyFrameInterpolations(getFrame(), &info->_C, &field_0x5c[info->_C._2]);
        if (val < -0x400) {
            param_1->b = -0x400;
        } else if (val > 0x3FF) {
            param_1->b = 0x3FF;
        } else {
            OSf32tos16(&val, &param_1->b);
        }
    }
    switch (info->_12._0) {
    case 0:
        param_1->a = 0;
        break;
    case 1:
        param_1->a = field_0x60[info->_12._2];
        break;
    default:
        val = J2DGetKeyFrameInterpolations(getFrame(), &info->_12, &field_0x60[info->_12._2]);
        if (val < -0x400) {
            param_1->a = -0x400;
        } else if (val > 0x3FF) {
            param_1->a = 0x3FF;
        } else {
            OSf32tos16(&val, &param_1->a);
        }
    }
}

/* 8030C3B4-8030C678 306CF4 02C4+00 0/0 1/1 0/0 .text
 * getTevKonstReg__15J2DAnmTevRegKeyCFUsP8_GXColor              */
void J2DAnmTevRegKey::getTevKonstReg(u16 param_0, _GXColor* param_1) const {
    J2DAnmTevRegKeyData* info = &mAnmKRegKeyTable[param_0];
    f32 val;
    switch (info->_0._0) {
    case 0:
        param_1->r = 0;
        break;
    case 1:
        param_1->r = field_0x64[info->_0._2];
        break;
    default:
        val = J2DGetKeyFrameInterpolations(getFrame(), &info->_0, &field_0x64[info->_0._2]);
        if (val < 0) {
            param_1->r = 0;
        } else if (val > 255) {
            param_1->r = 255;
        } else {
            OSf32tou8(&val, &param_1->r);
        }
    }
    switch (info->_6._0) {
    case 0:
        param_1->g = 0;
        break;
    case 1:
        param_1->g = field_0x68[info->_6._2];
        break;
    default:
        val = J2DGetKeyFrameInterpolations(getFrame(), &info->_6, &field_0x68[info->_6._2]);
        if (val < 0) {
            param_1->g = 0;
        } else if (val > 255) {
            param_1->g = 255;
        } else {
            OSf32tou8(&val, &param_1->g);
        }
    }
    switch (info->_C._0) {
    case 0:
        param_1->b = 0;
        break;
    case 1:
        param_1->b = field_0x6c[info->_C._2];
        break;
    default:
        val = J2DGetKeyFrameInterpolations(getFrame(), &info->_C, &field_0x6c[info->_C._2]);
        if (val < 0) {
            param_1->b = 0;
        } else if (val > 255) {
            param_1->b = 255;
        } else {
            OSf32tou8(&val, &param_1->b);
        }
    }
    switch (info->_12._0) {
    case 0:
        param_1->a = 0;
        break;
    case 1:
        param_1->a = field_0x70[info->_12._2];
        break;
    default:
        val = J2DGetKeyFrameInterpolations(getFrame(), &info->_12, &field_0x70[info->_12._2]);
        if (val < 0) {
            param_1->a = 0;
        } else if (val > 255) {
            param_1->a = 255;
        } else {
            OSf32tou8(&val, &param_1->a);
        }
    }
}

/* 8030C678-8030C77C 306FB8 0104+00 1/0 0/0 0/0 .text
 * searchUpdateMaterialID__15J2DAnmTevRegKeyFP9J2DScreen        */
void J2DAnmTevRegKey::searchUpdateMaterialID(J2DScreen* pScreen) {
    if (pScreen != NULL && pScreen->mNameTable != NULL) {
        for (u16 i = 0; i < mCRegUpdateMaterialNum; i++) {
            s32 idx = pScreen->mNameTable->getIndex(field_0x28.getName(i));
            if (idx != -1) {
                mCRegUpdateMaterialID[i] = idx;
            } else {
                mCRegUpdateMaterialID[i] = 0xFFFF;
            }
        }
        for (u16 i = 0; i < mKRegUpdateMaterialNum; i++) {
            s32 idx = pScreen->mNameTable->getIndex(field_0x3c.getName(i));
            if (idx != -1) {
                mKRegUpdateMaterialID[i] = idx;
            } else {
                mKRegUpdateMaterialID[i] = 0xFFFF;
            }
        }
    }
}

/* 8030C77C-8030C9B0 3070BC 0234+00 6/6 0/0 0/0 .text
 * J2DGetKeyFrameInterpolation<s>__FfP18J3DAnmKeyTableBasePs    */
// should be J2DGetKeyFrameInterpolation<s16>
f32 J2DGetKeyFrameInterpolations(f32 param_0, J3DAnmKeyTableBase* param_1, s16* param_2) {
    if (param_0 < param_2[0]) {
        return param_2[1];
    } else {
        if (param_1->_4 == 0) {
            if (param_2[(param_1->_0 - 1) * 3] <= param_0) {
                return param_2[(param_1->_0 - 1) * 3 + 1];
            } else {
                u32 tmp = param_1->_0;
                while (tmp > 1) {
                    u32 halfTmp = tmp / 2;
                    u32 upIdx = halfTmp * 3;
                    if (param_0 >= param_2[upIdx]) {
                        param_2 = param_2 + upIdx;
                        tmp -= halfTmp;
                    } else {
                        tmp = halfTmp;
                    }
                }
                return J2DHermiteInterpolation<s16>(param_0, &param_2[0], &param_2[1], &param_2[2],
                                                    &param_2[3], &param_2[4], &param_2[5]);
            }
        } else {
            if (param_2[(param_1->_0 - 1) * 4] <= param_0) {
                return param_2[(param_1->_0 - 1) * 4 + 1];
            } else {
                u32 tmp = param_1->_0;
                while (tmp > 1) {
                    u32 halfTmp = tmp / 2;
                    u32 upIdx = halfTmp * 4;
                    if (param_0 >= param_2[upIdx]) {
                        param_2 = param_2 + upIdx;
                        tmp -= halfTmp;
                    } else {
                        tmp = halfTmp;
                    }
                }
                return J2DHermiteInterpolation<s16>(param_0, &param_2[0], &param_2[1], &param_2[3],
                                                    &param_2[4], &param_2[5], &param_2[6]);
            }
        }
    }
}

/* 8030C9B0-8030CB2C 3072F0 017C+00 2/2 0/0 0/0 .text
 * J2DGetKeyFrameInterpolation<f>__FfP18J3DAnmKeyTableBasePf    */
// should be J2DGetKeyFrameInterpolation<s16>
f32 J2DGetKeyFrameInterpolationf(f32 param_0, J3DAnmKeyTableBase* param_1, f32* param_2) {
    if (param_0 < param_2[0]) {
        return param_2[1];
    } else {
        if (param_1->_4 == 0) {
            if (param_2[(param_1->_0 - 1) * 3] <= param_0) {
                return param_2[(param_1->_0 - 1) * 3 + 1];
            } else {
                u32 tmp = param_1->_0;
                while (tmp > 1) {
                    u32 halfTmp = tmp / 2;
                    u32 upIdx = halfTmp * 3;
                    if (param_0 >= param_2[upIdx]) {
                        param_2 = param_2 + upIdx;
                        tmp -= halfTmp;
                    } else {
                        tmp = halfTmp;
                    }
                }
                return J2DHermiteInterpolation<f32>(param_0, &param_2[0], &param_2[1], &param_2[2],
                                                    &param_2[3], &param_2[4], &param_2[5]);
            }
        } else {
            if (param_2[(param_1->_0 - 1) * 4] <= param_0) {
                return param_2[(param_1->_0 - 1) * 4 + 1];
            } else {
                u32 tmp = param_1->_0;
                while (tmp > 1) {
                    u32 halfTmp = tmp / 2;
                    u32 upIdx = halfTmp * 4;
                    if (param_0 >= param_2[upIdx]) {
                        param_2 = param_2 + upIdx;
                        tmp -= halfTmp;
                    } else {
                        tmp = halfTmp;
                    }
                }
                return J2DHermiteInterpolation<f32>(param_0, &param_2[0], &param_2[1], &param_2[3],
                                                    &param_2[4], &param_2[5], &param_2[6]);
            }
        }
    }
}

J2DAnmTexPattern::J2DAnmTexPatternTIMGPointer::J2DAnmTexPatternTIMGPointer() {
    mRes = NULL;
    mPalette = NULL;
}

J2DAnmTexPattern::J2DAnmTexPatternTIMGPointer::~J2DAnmTexPatternTIMGPointer() {
    delete mPalette;
}
