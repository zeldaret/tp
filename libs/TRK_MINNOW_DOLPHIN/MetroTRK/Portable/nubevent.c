//
// Generated By: dol2asm
// Translation Unit: MetroTRK/Portable/nubevent
//

#include "TRK_MINNOW_DOLPHIN/MetroTRK/Portable/nubevent.h"
#include "TRK_MINNOW_DOLPHIN/MetroTRK/Portable/msgbuf.h"
#include "TRK_MINNOW_DOLPHIN/MetroTRK/Portable/mutex_TRK.h"
#include "dol2asm.h"
#include "dolphin/types.h"

//
// Forward References:
//

void TRKDestructEvent();
void TRKConstructEvent(NubEvent*, NubEventType);
void TRKPostEvent();
u8 TRKGetNextEvent(NubEvent*);
u8 TRKInitializeEventQueue();

//
// External References:
//

SECTION_INIT void TRK_memcpy(void* dst, const void* src, size_t n);
void TRKReleaseBuffer();

//
// Declarations:
//

/* 8036CC18-8036CC3C 367558 0024+00 0/0 1/1 0/0 .text            TRKDestructEvent */
void TRKDestructEvent(NubEvent* event) {
    TRKReleaseBuffer(event->mMessageBufferID);
}

/* 8036CC3C-8036CC54 36757C 0018+00 0/0 5/5 0/0 .text            TRKConstructEvent */
void TRKConstructEvent(NubEvent* event, NubEventType eventType) {
    event->mType = eventType;
    event->mID = 0;
    event->mMessageBufferID = -1;
}

/* 8036CC54-8036CD34 367594 00E0+00 0/0 5/5 0/0 .text            TRKPostEvent */
#pragma push
#pragma optimization_level 0
#pragma optimizewithasm off
asm void TRKPostEvent() {
    nofralloc
#include "asm/TRK_MINNOW_DOLPHIN/MetroTRK/Portable/nubevent/TRKPostEvent.s"
}
#pragma pop

/* 8036CD34-8036CDE8 367674 00B4+00 0/0 1/1 0/0 .text            TRKGetNextEvent */
u8 TRKGetNextEvent(NubEvent* event) {
    u8 status = 0;
    TRKAcquireMutex(&gTRKEventQueue);
    if (0 < gTRKEventQueue.mCount) {
        TRK_memcpy(event, &gTRKEventQueue.mEventList[gTRKEventQueue.mFirst], sizeof(NubEvent));
        gTRKEventQueue.mCount--;
        if (++gTRKEventQueue.mFirst == 2) {
            gTRKEventQueue.mFirst = 0;
        }
        status = 1;
    }
    TRKReleaseMutex(&gTRKEventQueue);
    return status;
}

/* 8036CDE8-8036CE40 367728 0058+00 0/0 1/1 0/0 .text            TRKInitializeEventQueue */
u8 TRKInitializeEventQueue() {
    TRKInitializeMutex(&gTRKEventQueue);
    TRKAcquireMutex(&gTRKEventQueue);
    gTRKEventQueue.mCount = 0;
    gTRKEventQueue.mFirst = 0;
    gTRKEventQueue.mEventID = 0x100;
    TRKReleaseMutex();
    return 0;
}
