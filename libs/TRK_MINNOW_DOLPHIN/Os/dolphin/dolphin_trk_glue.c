//
// Generated By: dol2asm
// Translation Unit: Os/dolphin/dolphin_trk_glue
//

#include "TRK_MINNOW_DOLPHIN/Os/dolphin/dolphin_trk_glue.h"
#include "dol2asm.h"
#include "dolphin/types.h"

//
// Forward References:
//

static void TRKLoadContext();
void TRKUARTInterruptHandler();
void InitializeProgramEndTrap();
void TRK_board_display();
int TRKReadUARTN(void*, u32);
int TRKPollUART();
void EnableEXI2Interrupts();
int TRKInitializeIntDrivenUART();
void InitMetroTRKCommTable();
static void TRKEXICallBack(s16 param_0, OSContext* ctx);
SECTION_BSS extern u8 data_8044F828[8];

//
// External References:
//

SECTION_INIT void TRK_memcpy();
void PPCHalt();
void DCFlushRange();
void ICInvalidateRange();
void TRKInterruptHandler();
s32 udp_cc_post_stop();
s32 udp_cc_pre_continue();
u8 udp_cc_peek();
u8 udp_cc_write();
u8 udp_cc_read();
s32 udp_cc_close();
s32 udp_cc_open();
s32 udp_cc_shutdown();
s32 udp_cc_initialize();
void ddh_cc_initinterrupts();
void ddh_cc_peek();
void ddh_cc_post_stop();
void ddh_cc_pre_continue();
void ddh_cc_write();
void ddh_cc_read();
u8 ddh_cc_close();
void ddh_cc_open();
u8 ddh_cc_shutdown();
void ddh_cc_initialize();
void gdev_cc_initinterrupts();
void gdev_cc_peek();
void gdev_cc_post_stop();
void gdev_cc_pre_continue();
void gdev_cc_write();
void gdev_cc_read();
u8 gdev_cc_close();
void gdev_cc_open();
u8 gdev_cc_shutdown();
void gdev_cc_initialize();
u8 AMC_IsStub();
u8 Hu_IsStub();

//
// Declarations:
//

/* 80371BF4-80371C7C 36C534 0088+00 1/1 0/0 0/0 .text            TRKLoadContext */
#pragma push
#pragma optimization_level 0
#pragma optimizewithasm off
static asm void TRKLoadContext() {
    nofralloc
#include "asm/TRK_MINNOW_DOLPHIN/Os/dolphin/dolphin_trk_glue/TRKLoadContext.s"
}
#pragma pop

/* 80371C7C-80371C80 36C5BC 0004+00 0/0 1/1 0/0 .text            TRKUARTInterruptHandler */
void TRKUARTInterruptHandler() {
    /* empty function */
}

/* ############################################################################################## */
/* 803A2C08-803A2C0C 02F268 0004+00 2/2 0/0 0/0 .rodata          EndofProgramInstruction$162 */
SECTION_RODATA static u32 const EndofProgramInstruction = 0x00454E44;  // \0END
COMPILER_STRIP_GATE(0x803A2C08, &EndofProgramInstruction);

/* 80371C80-80371CD8 36C5C0 0058+00 0/0 1/1 0/0 .text            InitializeProgramEndTrap */
void InitializeProgramEndTrap() {
    u8* endOfProgramInstructionBytes = (u8*)&EndofProgramInstruction;
    u8* ppcHaltPtr = (u8*)PPCHalt;
    TRK_memcpy(ppcHaltPtr + 4, endOfProgramInstructionBytes, 4);
    ICInvalidateRange(ppcHaltPtr + 4, 4);
    DCFlushRange(ppcHaltPtr + 4, 4);
}

/* ############################################################################################## */
/* 803A2C0C-803A2C10 02F26C 0004+00 1/1 0/0 0/0 .rodata          @165 */
SECTION_RODATA static char const lit_165[] = "%s\n";
COMPILER_STRIP_GATE(0x803A2C0C, &lit_165);

/* 80371CD8-80371D08 36C618 0030+00 0/0 1/1 0/0 .text            TRK_board_display */
#pragma push
#pragma optimization_level 0
#pragma optimizewithasm off
asm void TRK_board_display() {
    nofralloc
#include "asm/TRK_MINNOW_DOLPHIN/Os/dolphin/dolphin_trk_glue/TRK_board_display.s"
}
#pragma pop

/* ############################################################################################## */
/* 803D32A8-803D32D0 0303C8 0028+00 8/8 0/0 0/0 .data            gDBCommTable */
static DBCommTable gDBCommTable = {};

/* 80371D08-80371D38 36C648 0030+00 0/0 1/1 0/0 .text            UnreserveEXI2Port */
void UnreserveEXI2Port() {
    gDBCommTable.pre_continue_func();
}

/* 80371D38-80371D68 36C678 0030+00 0/0 1/1 0/0 .text            ReserveEXI2Port */
void ReserveEXI2Port() {
    gDBCommTable.post_stop_func();
}

/* 80371D68-80371DA4 36C6A8 003C+00 0/0 13/13 0/0 .text            TRKWriteUARTN */
s32 TRKWriteUARTN(const void* bytes, u32 length) {
    int r3 = gDBCommTable.write_func(bytes, length);
    return ((-r3 | r3)) >> 31;
}

/* 80371DA4-80371DE0 36C6E4 003C+00 0/0 1/1 0/0 .text            TRKReadUARTN */
int TRKReadUARTN(void* bytes, u32 limit) {
    int r3 = gDBCommTable.read_func(bytes, limit);
    return ((-r3 | r3)) >> 31;
}

/* 80371DE0-80371E10 36C720 0030+00 0/0 1/1 0/0 .text            TRKPollUART */
int TRKPollUART() {
    return gDBCommTable.peek_func();
}

/* ############################################################################################## */
/* 8044F820-8044F824 07C540 0004+00 2/2 0/0 0/0 .bss             None */
SECTION_BSS static u8 data_8044F820[4];

/* 80371E10-80371E58 36C750 0048+00 0/0 1/1 0/0 .text            EnableEXI2Interrupts */
void EnableEXI2Interrupts() {
    if (!*data_8044F820) {
        if (gDBCommTable.initinterrupts_func != NULL) {
            gDBCommTable.initinterrupts_func();
        }
    }
}

/* 80371E58-80371EA8 36C798 0050+00 0/0 1/1 0/0 .text            TRKInitializeIntDrivenUART */
int TRKInitializeIntDrivenUART(u32 param_0, u32 param_1, u32 param_2, void* param_3) {
    gDBCommTable.initialize_func(param_3, TRKEXICallBack);
    gDBCommTable.open_func();
    return 0;
}

/* ############################################################################################## */
/* 803A2C10-803A2C28 02F270 0015+03 0/1 0/0 0/0 .rodata          @215 */
#pragma push
#pragma force_active on
SECTION_RODATA static char const lit_215[] = "Devkit set to : %ld\n";
COMPILER_STRIP_GATE(0x803A2C10, &lit_215);
#pragma pop

/* 803A2C28-803A2C40 02F288 0017+01 0/1 0/0 0/0 .rodata          @216 */
#pragma push
#pragma force_active on
SECTION_RODATA static char const lit_216[] = "MetroTRK : Set to BBA\n";
COMPILER_STRIP_GATE(0x803A2C28, &lit_216);
#pragma pop

/* 803A2C40-803A2C64 02F2A0 0021+03 0/1 0/0 0/0 .rodata          @217 */
#pragma push
#pragma force_active on
SECTION_RODATA static char const lit_217[] = "MetroTRK : Set to GDEV hardware\n";
COMPILER_STRIP_GATE(0x803A2C40, &lit_217);
#pragma pop

/* 803A2C64-803A2C88 02F2C4 0024+00 0/1 0/0 0/0 .rodata          @218 */
#pragma push
#pragma force_active on
SECTION_RODATA static char const lit_218[] = "MetroTRK : Set to AMC DDH hardware\n";
COMPILER_STRIP_GATE(0x803A2C64, &lit_218);
#pragma pop

/* 803A2C88-803A2CB4 02F2E8 002B+01 0/1 0/0 0/0 .rodata          @219 */
#pragma push
#pragma force_active on
SECTION_RODATA static char const lit_219[] = "MetroTRK : Set to UNKNOWN hardware. (%ld)\n";
COMPILER_STRIP_GATE(0x803A2C88, &lit_219);
#pragma pop

/* 803A2CB4-803A2CE4 02F314 002F+01 0/1 0/0 0/0 .rodata          @220 */
#pragma push
#pragma force_active on
SECTION_RODATA static char const lit_220[] = "MetroTRK : Invalid hardware ID passed from OS\n";
COMPILER_STRIP_GATE(0x803A2CB4, &lit_220);
#pragma pop

/* 803A2CE4-803A2D10 02F344 0028+04 0/1 0/0 0/0 .rodata          @221 */
#pragma push
#pragma force_active on
SECTION_RODATA static char const lit_221[] = "MetroTRK : Defaulting to GDEV Hardware\n";
COMPILER_STRIP_GATE(0x803A2CE4, &lit_221);
#pragma pop

/* 80371EA8-80372114 36C7E8 026C+00 0/0 2/2 0/0 .text            InitMetroTRKCommTable */
#pragma push
#pragma optimization_level 0
#pragma optimizewithasm off
asm void InitMetroTRKCommTable() {
    nofralloc
#include "asm/TRK_MINNOW_DOLPHIN/Os/dolphin/dolphin_trk_glue/InitMetroTRKCommTable.s"
}
#pragma pop

/* 80372114-8037214C 36CA54 0038+00 1/1 0/0 0/0 .text            TRKEXICallBack */
static void TRKEXICallBack(s16 param_0, OSContext* ctx) {
    OSEnableScheduler();
    TRKLoadContext(ctx, 0x500);
}

/* ############################################################################################## */
/* 8044F828-8044F830 07C548 0008+00 0/0 2/2 0/0 .bss             None */
SECTION_BSS extern u8 data_8044F828[8];
SECTION_BSS u8 data_8044F828[8];

/* 8044F824-8044F828 07C544 0004+00 0/0 0/0 0/0 .bss             _MetroTRK_Has_Framing */
SECTION_BSS /* static */ u8 _MetroTRK_Has_Framing[4];
