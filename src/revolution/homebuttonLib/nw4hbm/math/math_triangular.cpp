#include "triangular.h"

#include <revolution/types.h>

#include "../macros.h"

#include "arithmetic.h"

// typedef names are from the nw4r version (at least, SinCosSample is)

typedef struct /* explicitly untagged */
{
    f32 sin_val;    // size 0x04, offset 0x00
    f32 cos_val;    // size 0x04, offset 0x04
    f32 sin_delta;  // size 0x04, offset 0x08
    f32 cos_delta;  // size 0x04, offset 0x0c
} SinCosSample;     // size 0x10

typedef struct /* explicitly untagged */
{
    f32 asin_val;    // size 0x04, offset 0x00
    f32 acos_val;    // size 0x04, offset 0x04
    f32 asin_delta;  // size 0x04, offset 0x08
    f32 acos_delta;  // size 0x04, offset 0x0c
} ArcSinCosSample;   // size 0x10

typedef struct /* explicitly untagged */
{
    f32 atan_val;    // size 0x04, offset 0x00
    f32 atan_delta;  // size 0x04, offset 0x04
} ArcTanSample;      // size 0x08

namespace nw4hbm {
    namespace math {
        namespace {
            f32 AtanFIdx_(f32 x);
        }
    }  // namespace math
}  // namespace nw4hbm

namespace nw4hbm {
    namespace math {
        namespace {
            // .data
            SinCosSample sSinCosTbl[256 + 1] = {{0.0f, 1.0f, 0.024541f, -3.01e-4f},
                                                {0.024541f, 0.999699f, 0.024526f, -9.03e-4f},
                                                {0.049068f, 0.998795f, 0.024497f, -0.001505f},
                                                {0.073565f, 0.99729f, 0.024453f, -0.002106f},
                                                {0.098017f, 0.995185f, 0.024394f, -0.002705f},
                                                {0.122411f, 0.99248f, 0.02432f, -0.003303f},
                                                {0.14673f, 0.989177f, 0.024231f, -0.003899f},
                                                {0.170962f, 0.985278f, 0.024128f, -0.004492f},
                                                {0.19509f, 0.980785f, 0.024011f, -0.005083f},
                                                {0.219101f, 0.975702f, 0.023879f, -0.005671f},
                                                {0.24298f, 0.970031f, 0.023733f, -0.006255f},
                                                {0.266713f, 0.963776f, 0.023572f, -0.006836f},
                                                {0.290285f, 0.95694f, 0.023397f, -0.007412f},
                                                {0.313682f, 0.949528f, 0.023208f, -0.007984f},
                                                {0.33689f, 0.941544f, 0.023005f, -0.008551f},
                                                {0.359895f, 0.932993f, 0.022788f, -0.009113f},
                                                {0.382683f, 0.92388f, 0.022558f, -0.00967f},
                                                {0.405241f, 0.91421f, 0.022314f, -0.01022f},
                                                {0.427555f, 0.903989f, 0.022056f, -0.010765f},
                                                {0.449611f, 0.893224f, 0.021785f, -0.011303f},
                                                {0.471397f, 0.881921f, 0.021501f, -0.011834f},
                                                {0.492898f, 0.870087f, 0.021205f, -0.012358f},
                                                {0.514103f, 0.857729f, 0.020895f, -0.012875f},
                                                {0.534998f, 0.844854f, 0.020573f, -0.013384f},
                                                {0.55557f, 0.83147f, 0.020238f, -0.013885f},
                                                {0.575808f, 0.817585f, 0.019891f, -0.014377f},
                                                {0.595699f, 0.803208f, 0.019532f, -0.014861f},
                                                {0.615232f, 0.788346f, 0.019162f, -0.015336f},
                                                {0.634393f, 0.77301f, 0.01878f, -0.015802f},
                                                {0.653173f, 0.757209f, 0.018386f, -0.016258f},
                                                {0.671559f, 0.740951f, 0.017982f, -0.016704f},
                                                {0.689541f, 0.724247f, 0.017566f, -0.01714f},
                                                {0.707107f, 0.707107f, 0.01714f, -0.017566f},
                                                {0.724247f, 0.689541f, 0.016704f, -0.017982f},
                                                {0.740951f, 0.671559f, 0.016258f, -0.018386f},
                                                {0.757209f, 0.653173f, 0.015802f, -0.01878f},
                                                {0.77301f, 0.634393f, 0.015336f, -0.019162f},
                                                {0.788346f, 0.615232f, 0.014861f, -0.019532f},
                                                {0.803208f, 0.595699f, 0.014377f, -0.019891f},
                                                {0.817585f, 0.575808f, 0.013885f, -0.020238f},
                                                {0.83147f, 0.55557f, 0.013384f, -0.020573f},
                                                {0.844854f, 0.534998f, 0.012875f, -0.020895f},
                                                {0.857729f, 0.514103f, 0.012358f, -0.021205f},
                                                {0.870087f, 0.492898f, 0.011834f, -0.021501f},
                                                {0.881921f, 0.471397f, 0.011303f, -0.021785f},
                                                {0.893224f, 0.449611f, 0.010765f, -0.022056f},
                                                {0.903989f, 0.427555f, 0.01022f, -0.022314f},
                                                {0.91421f, 0.405241f, 0.00967f, -0.022558f},
                                                {0.92388f, 0.382683f, 0.009113f, -0.022788f},
                                                {0.932993f, 0.359895f, 0.008551f, -0.023005f},
                                                {0.941544f, 0.33689f, 0.007984f, -0.023208f},
                                                {0.949528f, 0.313682f, 0.007412f, -0.023397f},
                                                {0.95694f, 0.290285f, 0.006836f, -0.023572f},
                                                {0.963776f, 0.266713f, 0.006255f, -0.023733f},
                                                {0.970031f, 0.24298f, 0.005671f, -0.023879f},
                                                {0.975702f, 0.219101f, 0.005083f, -0.024011f},
                                                {0.980785f, 0.19509f, 0.004492f, -0.024128f},
                                                {0.985278f, 0.170962f, 0.003899f, -0.024231f},
                                                {0.989177f, 0.14673f, 0.003303f, -0.02432f},
                                                {0.99248f, 0.122411f, 0.002705f, -0.024394f},
                                                {0.995185f, 0.098017f, 0.002106f, -0.024453f},
                                                {0.99729f, 0.073565f, 0.001505f, -0.024497f},
                                                {0.998795f, 0.049068f, 9.03e-4f, -0.024526f},
                                                {0.999699f, 0.024541f, 3.01e-4f, -0.024541f},
                                                {1.0f, 0.0f, -3.01e-4f, -0.024541f},
                                                {0.999699f, -0.024541f, -9.03e-4f, -0.024526f},
                                                {0.998795f, -0.049068f, -0.001505f, -0.024497f},
                                                {0.99729f, -0.073565f, -0.002106f, -0.024453f},
                                                {0.995185f, -0.098017f, -0.002705f, -0.024394f},
                                                {0.99248f, -0.122411f, -0.003303f, -0.02432f},
                                                {0.989177f, -0.14673f, -0.003899f, -0.024231f},
                                                {0.985278f, -0.170962f, -0.004492f, -0.024128f},
                                                {0.980785f, -0.19509f, -0.005083f, -0.024011f},
                                                {0.975702f, -0.219101f, -0.005671f, -0.023879f},
                                                {0.970031f, -0.24298f, -0.006255f, -0.023733f},
                                                {0.963776f, -0.266713f, -0.006836f, -0.023572f},
                                                {0.95694f, -0.290285f, -0.007412f, -0.023397f},
                                                {0.949528f, -0.313682f, -0.007984f, -0.023208f},
                                                {0.941544f, -0.33689f, -0.008551f, -0.023005f},
                                                {0.932993f, -0.359895f, -0.009113f, -0.022788f},
                                                {0.92388f, -0.382683f, -0.00967f, -0.022558f},
                                                {0.91421f, -0.405241f, -0.01022f, -0.022314f},
                                                {0.903989f, -0.427555f, -0.010765f, -0.022056f},
                                                {0.893224f, -0.449611f, -0.011303f, -0.021785f},
                                                {0.881921f, -0.471397f, -0.011834f, -0.021501f},
                                                {0.870087f, -0.492898f, -0.012358f, -0.021205f},
                                                {0.857729f, -0.514103f, -0.012875f, -0.020895f},
                                                {0.844854f, -0.534998f, -0.013384f, -0.020573f},
                                                {0.83147f, -0.55557f, -0.013885f, -0.020238f},
                                                {0.817585f, -0.575808f, -0.014377f, -0.019891f},
                                                {0.803208f, -0.595699f, -0.014861f, -0.019532f},
                                                {0.788346f, -0.615232f, -0.015336f, -0.019162f},
                                                {0.77301f, -0.634393f, -0.015802f, -0.01878f},
                                                {0.757209f, -0.653173f, -0.016258f, -0.018386f},
                                                {0.740951f, -0.671559f, -0.016704f, -0.017982f},
                                                {0.724247f, -0.689541f, -0.01714f, -0.017566f},
                                                {0.707107f, -0.707107f, -0.017566f, -0.01714f},
                                                {0.689541f, -0.724247f, -0.017982f, -0.016704f},
                                                {0.671559f, -0.740951f, -0.018386f, -0.016258f},
                                                {0.653173f, -0.757209f, -0.01878f, -0.015802f},
                                                {0.634393f, -0.77301f, -0.019162f, -0.015336f},
                                                {0.615232f, -0.788346f, -0.019532f, -0.014861f},
                                                {0.595699f, -0.803208f, -0.019891f, -0.014377f},
                                                {0.575808f, -0.817585f, -0.020238f, -0.013885f},
                                                {0.55557f, -0.83147f, -0.020573f, -0.013384f},
                                                {0.534998f, -0.844854f, -0.020895f, -0.012875f},
                                                {0.514103f, -0.857729f, -0.021205f, -0.012358f},
                                                {0.492898f, -0.870087f, -0.021501f, -0.011834f},
                                                {0.471397f, -0.881921f, -0.021785f, -0.011303f},
                                                {0.449611f, -0.893224f, -0.022056f, -0.010765f},
                                                {0.427555f, -0.903989f, -0.022314f, -0.01022f},
                                                {0.405241f, -0.91421f, -0.022558f, -0.00967f},
                                                {0.382683f, -0.92388f, -0.022788f, -0.009113f},
                                                {0.359895f, -0.932993f, -0.023005f, -0.008551f},
                                                {0.33689f, -0.941544f, -0.023208f, -0.007984f},
                                                {0.313682f, -0.949528f, -0.023397f, -0.007412f},
                                                {0.290285f, -0.95694f, -0.023572f, -0.006836f},
                                                {0.266713f, -0.963776f, -0.023733f, -0.006255f},
                                                {0.24298f, -0.970031f, -0.023879f, -0.005671f},
                                                {0.219101f, -0.975702f, -0.024011f, -0.005083f},
                                                {0.19509f, -0.980785f, -0.024128f, -0.004492f},
                                                {0.170962f, -0.985278f, -0.024231f, -0.003899f},
                                                {0.14673f, -0.989177f, -0.02432f, -0.003303f},
                                                {0.122411f, -0.99248f, -0.024394f, -0.002705f},
                                                {0.098017f, -0.995185f, -0.024453f, -0.002106f},
                                                {0.073565f, -0.99729f, -0.024497f, -0.001505f},
                                                {0.049068f, -0.998795f, -0.024526f, -9.03e-4f},
                                                {0.024541f, -0.999699f, -0.024541f, -3.01e-4f},
                                                {0.0f, -1.0f, -0.024541f, 3.01e-4f},
                                                {-0.024541f, -0.999699f, -0.024526f, 9.03e-4f},
                                                {-0.049068f, -0.998795f, -0.024497f, 0.001505f},
                                                {-0.073565f, -0.99729f, -0.024453f, 0.002106f},
                                                {-0.098017f, -0.995185f, -0.024394f, 0.002705f},
                                                {-0.122411f, -0.99248f, -0.02432f, 0.003303f},
                                                {-0.14673f, -0.989177f, -0.024231f, 0.003899f},
                                                {-0.170962f, -0.985278f, -0.024128f, 0.004492f},
                                                {-0.19509f, -0.980785f, -0.024011f, 0.005083f},
                                                {-0.219101f, -0.975702f, -0.023879f, 0.005671f},
                                                {-0.24298f, -0.970031f, -0.023733f, 0.006255f},
                                                {-0.266713f, -0.963776f, -0.023572f, 0.006836f},
                                                {-0.290285f, -0.95694f, -0.023397f, 0.007412f},
                                                {-0.313682f, -0.949528f, -0.023208f, 0.007984f},
                                                {-0.33689f, -0.941544f, -0.023005f, 0.008551f},
                                                {-0.359895f, -0.932993f, -0.022788f, 0.009113f},
                                                {-0.382683f, -0.92388f, -0.022558f, 0.00967f},
                                                {-0.405241f, -0.91421f, -0.022314f, 0.01022f},
                                                {-0.427555f, -0.903989f, -0.022056f, 0.010765f},
                                                {-0.449611f, -0.893224f, -0.021785f, 0.011303f},
                                                {-0.471397f, -0.881921f, -0.021501f, 0.011834f},
                                                {-0.492898f, -0.870087f, -0.021205f, 0.012358f},
                                                {-0.514103f, -0.857729f, -0.020895f, 0.012875f},
                                                {-0.534998f, -0.844854f, -0.020573f, 0.013384f},
                                                {-0.55557f, -0.83147f, -0.020238f, 0.013885f},
                                                {-0.575808f, -0.817585f, -0.019891f, 0.014377f},
                                                {-0.595699f, -0.803208f, -0.019532f, 0.014861f},
                                                {-0.615232f, -0.788346f, -0.019162f, 0.015336f},
                                                {-0.634393f, -0.77301f, -0.01878f, 0.015802f},
                                                {-0.653173f, -0.757209f, -0.018386f, 0.016258f},
                                                {-0.671559f, -0.740951f, -0.017982f, 0.016704f},
                                                {-0.689541f, -0.724247f, -0.017566f, 0.01714f},
                                                {-0.707107f, -0.707107f, -0.01714f, 0.017566f},
                                                {-0.724247f, -0.689541f, -0.016704f, 0.017982f},
                                                {-0.740951f, -0.671559f, -0.016258f, 0.018386f},
                                                {-0.757209f, -0.653173f, -0.015802f, 0.01878f},
                                                {-0.77301f, -0.634393f, -0.015336f, 0.019162f},
                                                {-0.788346f, -0.615232f, -0.014861f, 0.019532f},
                                                {-0.803208f, -0.595699f, -0.014377f, 0.019891f},
                                                {-0.817585f, -0.575808f, -0.013885f, 0.020238f},
                                                {-0.83147f, -0.55557f, -0.013384f, 0.020573f},
                                                {-0.844854f, -0.534998f, -0.012875f, 0.020895f},
                                                {-0.857729f, -0.514103f, -0.012358f, 0.021205f},
                                                {-0.870087f, -0.492898f, -0.011834f, 0.021501f},
                                                {-0.881921f, -0.471397f, -0.011303f, 0.021785f},
                                                {-0.893224f, -0.449611f, -0.010765f, 0.022056f},
                                                {-0.903989f, -0.427555f, -0.01022f, 0.022314f},
                                                {-0.91421f, -0.405241f, -0.00967f, 0.022558f},
                                                {-0.92388f, -0.382683f, -0.009113f, 0.022788f},
                                                {-0.932993f, -0.359895f, -0.008551f, 0.023005f},
                                                {-0.941544f, -0.33689f, -0.007984f, 0.023208f},
                                                {-0.949528f, -0.313682f, -0.007412f, 0.023397f},
                                                {-0.95694f, -0.290285f, -0.006836f, 0.023572f},
                                                {-0.963776f, -0.266713f, -0.006255f, 0.023733f},
                                                {-0.970031f, -0.24298f, -0.005671f, 0.023879f},
                                                {-0.975702f, -0.219101f, -0.005083f, 0.024011f},
                                                {-0.980785f, -0.19509f, -0.004492f, 0.024128f},
                                                {-0.985278f, -0.170962f, -0.003899f, 0.024231f},
                                                {-0.989177f, -0.14673f, -0.003303f, 0.02432f},
                                                {-0.99248f, -0.122411f, -0.002705f, 0.024394f},
                                                {-0.995185f, -0.098017f, -0.002106f, 0.024453f},
                                                {-0.99729f, -0.073565f, -0.001505f, 0.024497f},
                                                {-0.998795f, -0.049068f, -9.03e-4f, 0.024526f},
                                                {-0.999699f, -0.024541f, -3.01e-4f, 0.024541f},
                                                {-1.0f, -0.0f, 3.01e-4f, 0.024541f},
                                                {-0.999699f, 0.024541f, 9.03e-4f, 0.024526f},
                                                {-0.998795f, 0.049068f, 0.001505f, 0.024497f},
                                                {-0.99729f, 0.073565f, 0.002106f, 0.024453f},
                                                {-0.995185f, 0.098017f, 0.002705f, 0.024394f},
                                                {-0.99248f, 0.122411f, 0.003303f, 0.02432f},
                                                {-0.989177f, 0.14673f, 0.003899f, 0.024231f},
                                                {-0.985278f, 0.170962f, 0.004492f, 0.024128f},
                                                {-0.980785f, 0.19509f, 0.005083f, 0.024011f},
                                                {-0.975702f, 0.219101f, 0.005671f, 0.023879f},
                                                {-0.970031f, 0.24298f, 0.006255f, 0.023733f},
                                                {-0.963776f, 0.266713f, 0.006836f, 0.023572f},
                                                {-0.95694f, 0.290285f, 0.007412f, 0.023397f},
                                                {-0.949528f, 0.313682f, 0.007984f, 0.023208f},
                                                {-0.941544f, 0.33689f, 0.008551f, 0.023005f},
                                                {-0.932993f, 0.359895f, 0.009113f, 0.022788f},
                                                {-0.92388f, 0.382683f, 0.00967f, 0.022558f},
                                                {-0.91421f, 0.405241f, 0.01022f, 0.022314f},
                                                {-0.903989f, 0.427555f, 0.010765f, 0.022056f},
                                                {-0.893224f, 0.449611f, 0.011303f, 0.021785f},
                                                {-0.881921f, 0.471397f, 0.011834f, 0.021501f},
                                                {-0.870087f, 0.492898f, 0.012358f, 0.021205f},
                                                {-0.857729f, 0.514103f, 0.012875f, 0.020895f},
                                                {-0.844854f, 0.534998f, 0.013384f, 0.020573f},
                                                {-0.83147f, 0.55557f, 0.013885f, 0.020238f},
                                                {-0.817585f, 0.575808f, 0.014377f, 0.019891f},
                                                {-0.803208f, 0.595699f, 0.014861f, 0.019532f},
                                                {-0.788346f, 0.615232f, 0.015336f, 0.019162f},
                                                {-0.77301f, 0.634393f, 0.015802f, 0.01878f},
                                                {-0.757209f, 0.653173f, 0.016258f, 0.018386f},
                                                {-0.740951f, 0.671559f, 0.016704f, 0.017982f},
                                                {-0.724247f, 0.689541f, 0.01714f, 0.017566f},
                                                {-0.707107f, 0.707107f, 0.017566f, 0.01714f},
                                                {-0.689541f, 0.724247f, 0.017982f, 0.016704f},
                                                {-0.671559f, 0.740951f, 0.018386f, 0.016258f},
                                                {-0.653173f, 0.757209f, 0.01878f, 0.015802f},
                                                {-0.634393f, 0.77301f, 0.019162f, 0.015336f},
                                                {-0.615232f, 0.788346f, 0.019532f, 0.014861f},
                                                {-0.595699f, 0.803208f, 0.019891f, 0.014377f},
                                                {-0.575808f, 0.817585f, 0.020238f, 0.013885f},
                                                {-0.55557f, 0.83147f, 0.020573f, 0.013384f},
                                                {-0.534998f, 0.844854f, 0.020895f, 0.012875f},
                                                {-0.514103f, 0.857729f, 0.021205f, 0.012358f},
                                                {-0.492898f, 0.870087f, 0.021501f, 0.011834f},
                                                {-0.471397f, 0.881921f, 0.021785f, 0.011303f},
                                                {-0.449611f, 0.893224f, 0.022056f, 0.010765f},
                                                {-0.427555f, 0.903989f, 0.022314f, 0.01022f},
                                                {-0.405241f, 0.91421f, 0.022558f, 0.00967f},
                                                {-0.382683f, 0.92388f, 0.022788f, 0.009113f},
                                                {-0.359895f, 0.932993f, 0.023005f, 0.008551f},
                                                {-0.33689f, 0.941544f, 0.023208f, 0.007984f},
                                                {-0.313682f, 0.949528f, 0.023397f, 0.007412f},
                                                {-0.290285f, 0.95694f, 0.023572f, 0.006836f},
                                                {-0.266713f, 0.963776f, 0.023733f, 0.006255f},
                                                {-0.24298f, 0.970031f, 0.023879f, 0.005671f},
                                                {-0.219101f, 0.975702f, 0.024011f, 0.005083f},
                                                {-0.19509f, 0.980785f, 0.024128f, 0.004492f},
                                                {-0.170962f, 0.985278f, 0.024231f, 0.003899f},
                                                {-0.14673f, 0.989177f, 0.02432f, 0.003303f},
                                                {-0.122411f, 0.99248f, 0.024394f, 0.002705f},
                                                {-0.098017f, 0.995185f, 0.024453f, 0.002106f},
                                                {-0.073565f, 0.99729f, 0.024497f, 0.001505f},
                                                {-0.049068f, 0.998795f, 0.024526f, 9.03e-4f},
                                                {-0.024541f, 0.999699f, 0.024541f, 3.01e-4f},
                                                {-0.0f, 1.0f, 0.024541f, -3.01e-4f}};

            ArcSinCosSample sArcSinCosTbl[256 + 1] =  // Cool
                {{-64.0f, 3.6059709f, 128.0f, -3.6059709f},
                 {-60.394028f, 1.5003443f, 124.39403f, -1.5003443f},
                 {-58.893684f, 1.1558853f, 122.893684f, -1.1558853f},
                 {-57.7378f, 0.9783807f, 121.7378f, -0.9783807f},
                 {-56.75942f, 0.8654625f, 120.75942f, -0.8654625f},
                 {-55.893955f, 0.7856303f, 119.89396f, -0.7856303f},
                 {-55.108326f, 0.7254319f, 119.10833f, -0.7254319f},
                 {-54.382893f, 0.6780138f, 118.3829f, -0.6780138f},
                 {-53.70488f, 0.63946503f, 117.70488f, -0.63946503f},
                 {-53.065414f, 0.60736895f, 117.065414f, -0.60736895f},
                 {-52.458046f, 0.58014077f, 116.458046f, -0.58014077f},
                 {-51.877907f, 0.55669224f, 115.87791f, -0.55669224f},
                 {-51.321213f, 0.5362481f, 115.32121f, -0.5362481f},
                 {-50.784966f, 0.5182391f, 114.784966f, -0.5182391f},
                 {-50.266727f, 0.50223655f, 114.26672f, -0.50223655f},
                 {-49.76449f, 0.48791075f, 113.76449f, -0.48791075f},
                 {-49.276577f, 0.47500342f, 113.27658f, -0.47500342f},
                 {-48.801575f, 0.46330896f, 112.801575f, -0.46330896f},
                 {-48.33827f, 0.45266145f, 112.338264f, -0.45266145f},
                 {-47.885605f, 0.4429253f, 111.885605f, -0.4429253f},
                 {-47.44268f, 0.4339886f, 111.44268f, -0.4339886f},
                 {-47.00869f, 0.42575786f, 111.00869f, -0.42575786f},
                 {-46.58293f, 0.41815457f, 110.58293f, -0.41815457f},
                 {-46.16478f, 0.411112f, 110.16478f, -0.411112f},
                 {-45.753666f, 0.4045733f, 109.75367f, -0.4045733f},
                 {-45.349094f, 0.39848942f, 109.34909f, -0.39848942f},
                 {-44.950603f, 0.39281803f, 108.95061f, -0.39281803f},
                 {-44.557785f, 0.38752234f, 108.557785f, -0.38752234f},
                 {-44.170265f, 0.3825701f, 108.170265f, -0.3825701f},
                 {-43.787693f, 0.37793303f, 107.7877f, -0.37793303f},
                 {-43.40976f, 0.3735862f, 107.40976f, -0.3735862f},
                 {-43.036175f, 0.36950755f, 107.03617f, -0.36950755f},
                 {-42.666668f, 0.36567745f, 106.666664f, -0.36567745f},
                 {-42.30099f, 0.36207834f, 106.30099f, -0.36207834f},
                 {-41.93891f, 0.35869464f, 105.93891f, -0.35869464f},
                 {-41.580215f, 0.35551232f, 105.580215f, -0.35551232f},
                 {-41.224705f, 0.35251874f, 105.2247f, -0.35251874f},
                 {-40.872185f, 0.34970257f, 104.872185f, -0.34970257f},
                 {-40.522484f, 0.3470535f, 104.522484f, -0.3470535f},
                 {-40.17543f, 0.3445623f, 104.17543f, -0.3445623f},
                 {-39.830868f, 0.34222052f, 103.830864f, -0.34222052f},
                 {-39.488647f, 0.34002057f, 103.48865f, -0.34002057f},
                 {-39.148624f, 0.33795545f, 103.14863f, -0.33795545f},
                 {-38.81067f, 0.33601892f, 102.81067f, -0.33601892f},
                 {-38.47465f, 0.3342052f, 102.47465f, -0.3342052f},
                 {-38.140446f, 0.33250913f, 102.14045f, -0.33250913f},
                 {-37.807938f, 0.33092588f, 101.80794f, -0.33092588f},
                 {-37.477013f, 0.3294512f, 101.47701f, -0.3294512f},
                 {-37.14756f, 0.32808113f, 101.14756f, -0.32808113f},
                 {-36.819477f, 0.32681206f, 100.81948f, -0.32681206f},
                 {-36.49267f, 0.32564083f, 100.49267f, -0.32564083f},
                 {-36.167027f, 0.32456443f, 100.16702f, -0.32456443f},
                 {-35.84246f, 0.32358024f, 99.84246f, -0.32358024f},
                 {-35.518883f, 0.3226859f, 99.51888f, -0.3226859f},
                 {-35.196194f, 0.32187927f, 99.1962f, -0.32187927f},
                 {-34.874317f, 0.32115844f, 98.87431f, -0.32115844f},
                 {-34.553158f, 0.32052177f, 98.553154f, -0.32052177f},
                 {-34.232635f, 0.31996778f, 98.232635f, -0.31996778f},
                 {-33.912666f, 0.31949517f, 97.91267f, -0.31949517f},
                 {-33.593174f, 0.31910297f, 97.59317f, -0.31910297f},
                 {-33.27407f, 0.31879023f, 97.27407f, -0.31879023f},
                 {-32.95528f, 0.31855628f, 96.95528f, -0.31855628f},
                 {-32.636723f, 0.3184006f, 96.63673f, -0.3184006f},
                 {-32.31832f, 0.31832284f, 96.31832f, -0.31832284f},
                 {-32.0f, 0.31832284f, 96.0f, -0.31832284f},
                 {-31.681677f, 0.3184006f, 95.68168f, -0.3184006f},
                 {-31.363277f, 0.31855628f, 95.36327f, -0.31855628f},
                 {-31.04472f, 0.31879023f, 95.04472f, -0.31879023f},
                 {-30.72593f, 0.31910297f, 94.72593f, -0.31910297f},
                 {-30.406828f, 0.31949517f, 94.40683f, -0.31949517f},
                 {-30.087332f, 0.31996778f, 94.08733f, -0.31996778f},
                 {-29.767365f, 0.32052177f, 93.767365f, -0.32052177f},
                 {-29.446842f, 0.32115844f, 93.446846f, -0.32115844f},
                 {-29.125685f, 0.32187927f, 93.12569f, -0.32187927f},
                 {-28.803804f, 0.3226859f, 92.8038f, -0.3226859f},
                 {-28.48112f, 0.32358024f, 92.48112f, -0.32358024f},
                 {-28.15754f, 0.32456443f, 92.15754f, -0.32456443f},
                 {-27.832973f, 0.32564083f, 91.83298f, -0.32564083f},
                 {-27.507334f, 0.32681206f, 91.50733f, -0.32681206f},
                 {-27.180521f, 0.32808113f, 91.18052f, -0.32808113f},
                 {-26.85244f, 0.3294512f, 90.85244f, -0.3294512f},
                 {-26.52299f, 0.33092588f, 90.52299f, -0.33092588f},
                 {-26.192062f, 0.33250913f, 90.19206f, -0.33250913f},
                 {-25.859554f, 0.3342052f, 89.85955f, -0.3342052f},
                 {-25.525349f, 0.33601892f, 89.52535f, -0.33601892f},
                 {-25.18933f, 0.33795545f, 89.18933f, -0.33795545f},
                 {-24.851374f, 0.34002057f, 88.85137f, -0.34002057f},
                 {-24.511354f, 0.34222052f, 88.51135f, -0.34222052f},
                 {-24.169134f, 0.3445623f, 88.169136f, -0.3445623f},
                 {-23.824572f, 0.3470535f, 87.82457f, -0.3470535f},
                 {-23.477518f, 0.34970257f, 87.477516f, -0.34970257f},
                 {-23.127815f, 0.35251874f, 87.127815f, -0.35251874f},
                 {-22.775295f, 0.35551232f, 86.7753f, -0.35551232f},
                 {-22.419785f, 0.35869464f, 86.419785f, -0.35869464f},
                 {-22.061089f, 0.36207834f, 86.06109f, -0.36207834f},
                 {-21.69901f, 0.36567745f, 85.69901f, -0.36567745f},
                 {-21.333334f, 0.36950755f, 85.333336f, -0.36950755f},
                 {-20.963825f, 0.3735862f, 84.96383f, -0.3735862f},
                 {-20.59024f, 0.37793303f, 84.59024f, -0.37793303f},
                 {-20.212307f, 0.3825701f, 84.2123f, -0.3825701f},
                 {-19.829737f, 0.38752234f, 83.829735f, -0.38752234f},
                 {-19.442215f, 0.39281803f, 83.442215f, -0.39281803f},
                 {-19.049397f, 0.39848942f, 83.04939f, -0.39848942f},
                 {-18.650908f, 0.4045733f, 82.65091f, -0.4045733f},
                 {-18.246334f, 0.411112f, 82.24633f, -0.411112f},
                 {-17.835222f, 0.41815457f, 81.83522f, -0.41815457f},
                 {-17.417067f, 0.42575786f, 81.41707f, -0.42575786f},
                 {-16.991308f, 0.4339886f, 80.99131f, -0.4339886f},
                 {-16.55732f, 0.4429253f, 80.55732f, -0.4429253f},
                 {-16.114395f, 0.45266145f, 80.114395f, -0.45266145f},
                 {-15.661734f, 0.46330896f, 79.661736f, -0.46330896f},
                 {-15.198424f, 0.47500342f, 79.198425f, -0.47500342f},
                 {-14.723421f, 0.48791075f, 78.72342f, -0.48791075f},
                 {-14.235511f, 0.50223655f, 78.23551f, -0.50223655f},
                 {-13.7332735f, 0.5182391f, 77.73328f, -0.5182391f},
                 {-13.2150345f, 0.5362481f, 77.215034f, -0.5362481f},
                 {-12.678786f, 0.55669224f, 76.67879f, -0.55669224f},
                 {-12.122094f, 0.58014077f, 76.12209f, -0.58014077f},
                 {-11.541954f, 0.60736895f, 75.541954f, -0.60736895f},
                 {-10.934585f, 0.63946503f, 74.934586f, -0.63946503f},
                 {-10.29512f, 0.6780138f, 74.29512f, -0.6780138f},
                 {-9.617106f, 0.7254319f, 73.6171f, -0.7254319f},
                 {-8.891674f, 0.7856303f, 72.89167f, -0.7856303f},
                 {-8.106044f, 0.8654625f, 72.10604f, -0.8654625f},
                 {-7.240581f, 0.9783807f, 71.24058f, -0.9783807f},
                 {-6.2622004f, 1.1558853f, 70.2622f, -1.1558853f},
                 {-5.106315f, 1.5003443f, 69.106316f, -1.5003443f},
                 {-3.6059709f, 3.6059709f, 67.60597f, -3.6059709f},
                 {0.0f, 3.6059709f, 64.0f, -3.6059709f},
                 {3.6059709f, 1.5003443f, 60.394028f, -1.5003443f},
                 {5.106315f, 1.1558853f, 58.893684f, -1.1558853f},
                 {6.2622004f, 0.9783807f, 57.7378f, -0.9783807f},
                 {7.240581f, 0.8654625f, 56.75942f, -0.8654625f},
                 {8.106044f, 0.7856303f, 55.893955f, -0.7856303f},
                 {8.891674f, 0.7254319f, 55.108326f, -0.7254319f},
                 {9.617106f, 0.6780138f, 54.382893f, -0.6780138f},
                 {10.29512f, 0.63946503f, 53.70488f, -0.63946503f},
                 {10.934585f, 0.60736895f, 53.065414f, -0.60736895f},
                 {11.541954f, 0.58014077f, 52.458046f, -0.58014077f},
                 {12.122094f, 0.55669224f, 51.877907f, -0.55669224f},
                 {12.678786f, 0.5362481f, 51.321213f, -0.5362481f},
                 {13.2150345f, 0.5182391f, 50.784966f, -0.5182391f},
                 {13.7332735f, 0.50223655f, 50.266727f, -0.50223655f},
                 {14.235511f, 0.48791075f, 49.76449f, -0.48791075f},
                 {14.723421f, 0.47500342f, 49.276577f, -0.47500342f},
                 {15.198424f, 0.46330896f, 48.801575f, -0.46330896f},
                 {15.661734f, 0.45266145f, 48.33827f, -0.45266145f},
                 {16.114395f, 0.4429253f, 47.885605f, -0.4429253f},
                 {16.55732f, 0.4339886f, 47.44268f, -0.4339886f},
                 {16.991308f, 0.42575786f, 47.00869f, -0.42575786f},
                 {17.417067f, 0.41815457f, 46.58293f, -0.41815457f},
                 {17.835222f, 0.411112f, 46.16478f, -0.411112f},
                 {18.246334f, 0.4045733f, 45.753666f, -0.4045733f},
                 {18.650908f, 0.39848942f, 45.349094f, -0.39848942f},
                 {19.049397f, 0.39281803f, 44.950603f, -0.39281803f},
                 {19.442215f, 0.38752234f, 44.557785f, -0.38752234f},
                 {19.829737f, 0.3825701f, 44.170265f, -0.3825701f},
                 {20.212307f, 0.37793303f, 43.787693f, -0.37793303f},
                 {20.59024f, 0.3735862f, 43.40976f, -0.3735862f},
                 {20.963825f, 0.36950755f, 43.036175f, -0.36950755f},
                 {21.333334f, 0.36567745f, 42.666668f, -0.36567745f},
                 {21.69901f, 0.36207834f, 42.30099f, -0.36207834f},
                 {22.061089f, 0.35869464f, 41.93891f, -0.35869464f},
                 {22.419785f, 0.35551232f, 41.580215f, -0.35551232f},
                 {22.775295f, 0.35251874f, 41.224705f, -0.35251874f},
                 {23.127815f, 0.34970257f, 40.872185f, -0.34970257f},
                 {23.477518f, 0.3470535f, 40.522484f, -0.3470535f},
                 {23.824572f, 0.3445623f, 40.17543f, -0.3445623f},
                 {24.169134f, 0.34222052f, 39.830868f, -0.34222052f},
                 {24.511354f, 0.34002057f, 39.488647f, -0.34002057f},
                 {24.851374f, 0.33795545f, 39.148624f, -0.33795545f},
                 {25.18933f, 0.33601892f, 38.81067f, -0.33601892f},
                 {25.525349f, 0.3342052f, 38.47465f, -0.3342052f},
                 {25.859554f, 0.33250913f, 38.140446f, -0.33250913f},
                 {26.192062f, 0.33092588f, 37.807938f, -0.33092588f},
                 {26.52299f, 0.3294512f, 37.477013f, -0.3294512f},
                 {26.85244f, 0.32808113f, 37.14756f, -0.32808113f},
                 {27.180521f, 0.32681206f, 36.819477f, -0.32681206f},
                 {27.507334f, 0.32564083f, 36.49267f, -0.32564083f},
                 {27.832973f, 0.32456443f, 36.167027f, -0.32456443f},
                 {28.15754f, 0.32358024f, 35.84246f, -0.32358024f},
                 {28.48112f, 0.3226859f, 35.518883f, -0.3226859f},
                 {28.803804f, 0.32187927f, 35.196194f, -0.32187927f},
                 {29.125685f, 0.32115844f, 34.874317f, -0.32115844f},
                 {29.446842f, 0.32052177f, 34.553158f, -0.32052177f},
                 {29.767365f, 0.31996778f, 34.232635f, -0.31996778f},
                 {30.087332f, 0.31949517f, 33.912666f, -0.31949517f},
                 {30.406828f, 0.31910297f, 33.593174f, -0.31910297f},
                 {30.72593f, 0.31879023f, 33.27407f, -0.31879023f},
                 {31.04472f, 0.31855628f, 32.95528f, -0.31855628f},
                 {31.363277f, 0.3184006f, 32.636723f, -0.3184006f},
                 {31.681677f, 0.31832284f, 32.31832f, -0.31832284f},
                 {32.0f, 0.31832284f, 32.0f, -0.31832284f},
                 {32.31832f, 0.3184006f, 31.681677f, -0.3184006f},
                 {32.636723f, 0.31855628f, 31.363277f, -0.31855628f},
                 {32.95528f, 0.31879023f, 31.04472f, -0.31879023f},
                 {33.27407f, 0.31910297f, 30.72593f, -0.31910297f},
                 {33.593174f, 0.31949517f, 30.406828f, -0.31949517f},
                 {33.912666f, 0.31996778f, 30.087332f, -0.31996778f},
                 {34.232635f, 0.32052177f, 29.767365f, -0.32052177f},
                 {34.553158f, 0.32115844f, 29.446842f, -0.32115844f},
                 {34.874317f, 0.32187927f, 29.125685f, -0.32187927f},
                 {35.196194f, 0.3226859f, 28.803804f, -0.3226859f},
                 {35.518883f, 0.32358024f, 28.48112f, -0.32358024f},
                 {35.84246f, 0.32456443f, 28.15754f, -0.32456443f},
                 {36.167027f, 0.32564083f, 27.832973f, -0.32564083f},
                 {36.49267f, 0.32681206f, 27.507334f, -0.32681206f},
                 {36.819477f, 0.32808113f, 27.180521f, -0.32808113f},
                 {37.14756f, 0.3294512f, 26.85244f, -0.3294512f},
                 {37.477013f, 0.33092588f, 26.52299f, -0.33092588f},
                 {37.807938f, 0.33250913f, 26.192062f, -0.33250913f},
                 {38.140446f, 0.3342052f, 25.859554f, -0.3342052f},
                 {38.47465f, 0.33601892f, 25.525349f, -0.33601892f},
                 {38.81067f, 0.33795545f, 25.18933f, -0.33795545f},
                 {39.148624f, 0.34002057f, 24.851374f, -0.34002057f},
                 {39.488647f, 0.34222052f, 24.511354f, -0.34222052f},
                 {39.830868f, 0.3445623f, 24.169134f, -0.3445623f},
                 {40.17543f, 0.3470535f, 23.824572f, -0.3470535f},
                 {40.522484f, 0.34970257f, 23.477518f, -0.34970257f},
                 {40.872185f, 0.35251874f, 23.127815f, -0.35251874f},
                 {41.224705f, 0.35551232f, 22.775295f, -0.35551232f},
                 {41.580215f, 0.35869464f, 22.419785f, -0.35869464f},
                 {41.93891f, 0.36207834f, 22.061089f, -0.36207834f},
                 {42.30099f, 0.36567745f, 21.69901f, -0.36567745f},
                 {42.666668f, 0.36950755f, 21.333334f, -0.36950755f},
                 {43.036175f, 0.3735862f, 20.963825f, -0.3735862f},
                 {43.40976f, 0.37793303f, 20.59024f, -0.37793303f},
                 {43.787693f, 0.3825701f, 20.212307f, -0.3825701f},
                 {44.170265f, 0.38752234f, 19.829737f, -0.38752234f},
                 {44.557785f, 0.39281803f, 19.442215f, -0.39281803f},
                 {44.950603f, 0.39848942f, 19.049397f, -0.39848942f},
                 {45.349094f, 0.4045733f, 18.650908f, -0.4045733f},
                 {45.753666f, 0.411112f, 18.246334f, -0.411112f},
                 {46.16478f, 0.41815457f, 17.835222f, -0.41815457f},
                 {46.58293f, 0.42575786f, 17.417067f, -0.42575786f},
                 {47.00869f, 0.4339886f, 16.991308f, -0.4339886f},
                 {47.44268f, 0.4429253f, 16.55732f, -0.4429253f},
                 {47.885605f, 0.45266145f, 16.114395f, -0.45266145f},
                 {48.33827f, 0.46330896f, 15.661734f, -0.46330896f},
                 {48.801575f, 0.47500342f, 15.198424f, -0.47500342f},
                 {49.276577f, 0.48791075f, 14.723421f, -0.48791075f},
                 {49.76449f, 0.50223655f, 14.235511f, -0.50223655f},
                 {50.266727f, 0.5182391f, 13.7332735f, -0.5182391f},
                 {50.784966f, 0.5362481f, 13.2150345f, -0.5362481f},
                 {51.321213f, 0.55669224f, 12.678786f, -0.55669224f},
                 {51.877907f, 0.58014077f, 12.122094f, -0.58014077f},
                 {52.458046f, 0.60736895f, 11.541954f, -0.60736895f},
                 {53.065414f, 0.63946503f, 10.934585f, -0.63946503f},
                 {53.70488f, 0.6780138f, 10.29512f, -0.6780138f},
                 {54.382893f, 0.7254319f, 9.617106f, -0.7254319f},
                 {55.108326f, 0.7856303f, 8.891674f, -0.7856303f},
                 {55.893955f, 0.8654625f, 8.106044f, -0.8654625f},
                 {56.75942f, 0.9783807f, 7.240581f, -0.9783807f},
                 {57.7378f, 1.1558853f, 6.2622004f, -1.1558853f},
                 {58.893684f, 1.5003443f, 5.106315f, -1.5003443f},
                 {60.394028f, 3.6059709f, 3.6059709f, -3.6059709f},
                 {64.0f, 0.0f, 0.0f, -0.0f}};

            ArcTanSample sArcTanTbl[32 + 1] = {
                {0.0f, 1.2728254f},        {1.2728254f, 1.2703458f}, {2.5431712f, 1.2654155f},
                {3.8085866f, 1.2580916f},  {5.0666785f, 1.2484571f}, {6.3151355f, 1.2366195f},
                {7.551755f, 1.2227072f},   {8.774462f, 1.2068666f},  {9.981329f, 1.1892582f},
                {11.170587f, 1.1700529f},  {12.34064f, 1.149428f},   {13.4900675f, 1.1275644f},
                {14.617632f, 1.1046423f},  {15.722275f, 1.0808387f}, {16.803114f, 1.0563251f},
                {17.859438f, 1.0312649f},  {18.890703f, 1.005812f},  {19.896515f, 0.98010963f},
                {20.876625f, 0.9542891f},  {21.830914f, 0.9284698f}, {22.759384f, 0.90275896f},
                {23.662142f, 0.87725157f}, {24.539394f, 0.8520309f}, {25.391424f, 0.8271689f},
                {26.218594f, 0.802727f},   {27.02132f, 0.77875656f}, {27.800077f, 0.7553001f},
                {28.555378f, 0.7323915f},  {29.28777f, 0.7100574f},  {29.997826f, 0.6883175f},
                {30.686144f, 0.66718566f}, {31.353329f, 0.6466705f}, {32.0f, 0.62677616f}};
        }  // namespace
    }  // namespace math
}  // namespace nw4hbm

namespace nw4hbm {
    namespace math {

        namespace {

            f32 AtanFIdx_(f32 x) {
                u16 idx;
                f32 val;
                f32 r;

                x *= 32.0f;

                idx = F32ToU16(x);
                r = x - U16ToF32(idx);
                val = sArcTanTbl[idx].atan_val + r * sArcTanTbl[idx].atan_delta;

                return val;
            }

        }  // unnamed namespace

        f32 SinFIdx(f32 fidx) {
            f32 abs_fidx = FAbs(fidx);
            f32 val;
            u16 idx;
            f32 r;

            // mom can we have fmodf?
            while (abs_fidx >= 65536.0f)
                abs_fidx -= 65536.0f;

            idx = F32ToU16(abs_fidx);
            r = abs_fidx - U16ToF32(idx);

            idx &= 0xff;

            val = sSinCosTbl[idx].sin_val + r * sSinCosTbl[idx].sin_delta;

            return fidx < 0.0f ? -val : val;
        }

        f32 CosFIdx(f32 fidx) {
            u16 idx;
            f32 r;

            fidx = FAbs(fidx);

            // no, honey, we have fmodf at home
            while (fidx >= 65536.0f)
                fidx -= 65536.0f;

            idx = F32ToU16(fidx);
            r = fidx - U16ToF32(idx);

            idx &= 0xff;

            return sSinCosTbl[idx].cos_val + r * sSinCosTbl[idx].cos_delta;
        }

        void SinCosFIdx(f32* s, f32* c, f32 fidx) {
            u16 idx;
            f32 abs_fidx;
            f32 r;
            f32 cVal, sVal;

            abs_fidx = FAbs(fidx);

            // fmodf at home:
            while (abs_fidx >= 65536.0f)
                abs_fidx -= 65536.0f;

            idx = F32ToU16(abs_fidx);
            r = abs_fidx - U16ToF32(idx);

            idx &= 0xff;

            sVal = sSinCosTbl[idx].sin_val + sSinCosTbl[idx].sin_delta * r;
            cVal = sSinCosTbl[idx].cos_val + sSinCosTbl[idx].cos_delta * r;

            *s = fidx < 0.0f ? -sVal : sVal;
            *c = cVal;
        }

        f32 AtanFIdx(f32 x) {
            if (x >= 0.0f) {
                if (x > 1.0f)
                    return 64.0f - AtanFIdx_(1.0f / x);
                else
                    return AtanFIdx_(x);
            } else {
                if (x < -1.0f)
                    return -64.0f + AtanFIdx_(-1.0f / x);
                else
                    return -AtanFIdx_(-x);
            }
        }

        f32 Atan2FIdx(f32 y, f32 x) {
            f32 a;
            f32 b;
            f32 c;
            bool minus;

            if (x == 0.0f && y == 0.0f)
                return 0.0f;

            if (x >= 0.0f) {
                if (y >= 0.0f) {
                    if (x >= y) {
                        a = x;
                        b = y;
                        c = 0.0f;

                        minus = FALSE;
                    } else {
                        a = y;
                        b = x;
                        c = 64.0f;

                        minus = TRUE;
                    }
                } else {
                    if (x >= -y) {
                        a = x;
                        b = -y;
                        c = 0.0f;

                        minus = TRUE;
                    } else {
                        a = -y;
                        b = x;
                        c = -64.0f;

                        minus = FALSE;
                    }
                }
            } else {
                if (y >= 0.0f) {
                    if (-x >= y) {
                        a = -x;
                        b = y;
                        c = 128.0f;

                        minus = TRUE;
                    } else {
                        a = y;
                        b = -x;
                        c = 64.0f;

                        minus = FALSE;
                    }
                } else {
                    if (-x >= -y) {
                        a = -x;
                        b = -y;
                        c = -128.0f;

                        minus = FALSE;
                    } else {
                        a = -y;
                        b = -x;
                        c = -64.0f;

                        minus = TRUE;
                    }
                }
            }

            return minus ? c - AtanFIdx_(b / a) : c + AtanFIdx_(b / a);
        }

    }  // namespace math
}  // namespace nw4hbm
