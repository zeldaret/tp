/* d_model.cpp autogenerated by split.py v0.4 at 2021-03-28 21:24:51.606698 */

#include "d/d_model/d_model.h"
#include "JSystem/J3DGraphBase/J3DDrawBuffer/J3DDrawBuffer.h"
#include "JSystem/JKernel/JKRHeap/JKRHeap.h"
#include "d/d_com/d_com_inf_game/d_com_inf_game.h"

// additional symbols needed for d_model.cpp
// autogenerated by split.py v0.4 at 2021-03-28 21:24:51.606729
extern "C" {
void GXLoadNrmMtxImm(void);
void GXLoadPosMtxImm(void);
void GXSetChanAmbColor(void);
void GXSetChanMatColor(void);
// void PSMTXConcat(void);
void __construct_array(void);
void __ct__6dMdl_cFv(void);
void __destroy_arr(void);
void __dl__FPv(void);
void __dt__6dMdl_cFv(void);
void __nw__FUl(void);
void _restgpr_27(void);
void _restgpr_28(void);
void _savegpr_27(void);
void _savegpr_28(void);
void create__10dMdl_mng_cFv(void);
void create__6dMdl_cFP12J3DModelDataUsP12dKy_tevstr_c(void);
void dKy_GxFog_tevstr_set__FP12dKy_tevstr_c(void);
void dKy_setLight_again__Fv(void);
void dKy_setLight_nowroom_actor__FP12dKy_tevstr_c(void);
void entryImm__13J3DDrawBufferFP9J3DPacketUs(void);
void entry__10dMdl_mng_cFP12J3DModelDataUsP12dKy_tevstr_c(void);
void func_8009C668(void);
void func_8009C8D8(void);
void loadPreDrawSetting__8J3DShapeCFv(void);
void remove__10dMdl_mng_cFv(void);
void reset__10dMdl_mng_cFv(void);
void search__10dMdl_mng_cFP12J3DModelDataUsP12dKy_tevstr_c(void);
}

// additional symbols needed for d_model.cpp
// autogenerated by split.py v0.4 at 2021-03-28 21:24:51.606734
extern u8 lbl_803AF978;
extern u8 lbl_803CD97C;
extern u8 lbl_803F6094;
extern u8 lbl_80434AC8;
extern u8 lbl_80450608;
extern dMdl_mng_c* _m_myObj;
extern u8 lbl_804515D0;
extern u8 lbl_80456B70;

asm void dMdl_c::draw(void) {
    nofralloc
#include "d/d_model/asm/func_8009C4FC.s"
}

// create__6dMdl_cFP12J3DModelDataUsP12dKy_tevstr_c
// dMdl_c::create(J3DModelData*, u16, dKy_tevstr_c*)
void dMdl_c::create(J3DModelData* pModelData, u16 param_2, dKy_tevstr_c* pKyTestStr) {
    mpModelData = pModelData;
    field_0x18 = param_2;
    mpKyTestStr = pKyTestStr;
    field_0x1a = 0;
}

// 1 off, Missing mr instruction
#ifdef NON_MATCHING
void dMdl_c::entryObj(dMdl_obj_c* pModelObject) {
    if (!field_0x1a) {
        J3DDrawBuffer::entryImm(g_dComIfG_gameInfo.getDrawlist().mpPacket, 0);
        field_0x1a = 1;
        mpModelObject = 0;
    }
    pModelObject->mpModelObject = this->mpModelObject;
    mpModelObject = pModelObject;
}
#else
asm void dMdl_c::entryObj(dMdl_obj_c*) {
    nofralloc
#include "d/d_model/asm/func_8009C668.s"
}
#endif

#ifdef NON_MATCHING
dMdl_mng_c* dMdl_mng_c::search(J3DModelData* param_1, u16 param_2, dKy_tevstr_c* param_3) {
    u8 tmp = field_0x80;
    dMdl_mng_c* ret = this;
    while (true) {
        if (tmp > 0) {
            ret = 0;
        }

        if (mpModelData == param_1 && param_2 == field_0x18 && mpKyTevStr == param_3) {
            break;
        }
        // this = mpModelManager
        tmp += 0x20;
    }

    return ret;
}
#else
asm dMdl_mng_c* dMdl_mng_c::search(J3DModelData*, u16, dKy_tevstr_c*) {
    nofralloc
#include "d/d_model/asm/func_8009C6DC.s"
}
#endif

// 2 instructions off
#ifdef NON_MATCHING
dMdl_c* dMdl_mng_c::entry(J3DModelData* param_1, u16 param_2, dKy_tevstr_c* param_3) {
    dMdl_c* pModelMng = (dMdl_c*)search(param_1, param_2, param_3);
    if (!pModelMng) {
        if (field_0x80 >= 4) {
            pModelMng = 0;
        } else {
            pModelMng = (dMdl_c*)(&field_0x0 + (field_0x80 * 0x20));
            pModelMng->create(param_1, param_2, param_3);
            field_0x80++;
        }
    }

    return pModelMng;
}
#else
asm dMdl_c* dMdl_mng_c::entry(J3DModelData*, u16, dKy_tevstr_c*) {
    nofralloc
#include "d/d_model/asm/func_8009C724.s"
}
#endif

// create__10dMdl_mng_cFv
// dMdl_mng_c::create(void)
#ifdef NON_MATCHING
void dMdl_mng_c::create(void) {
    // void* block = JKRHeap::JKRHeap();

    if (block) {
        dMdl_c model;
        block + 0x80 = 0;
    }
    _m_myObj = block;
}
#else
asm void dMdl_mng_c::create(void) {
    nofralloc
#include "d/d_model/asm/func_8009C7AC.s"
}
#endif

// __dt__6dMdl_cFv
// dMdl_c::~dMdl_c(void)
asm dMdl_c::~dMdl_c(void) {
    nofralloc
#include "d/d_model/asm/func_8009C808.s"
}

// remove__10dMdl_mng_cFv
// dMdl_mng_c::remove(void)
asm void dMdl_mng_c::remove(void) {
    nofralloc
#include "d/d_model/asm/func_8009C864.s"
}

void dMdl_mng_c::reset(void) {
    if (!_m_myObj) {
        return;
    }
    _m_myObj->field_0x80 = 0;
}

// entry__10dMdl_mng_cFP12J3DModelDataUsi
// dMdl_mng_c::entry(J3DModelData*, u16, int)
asm void dMdl_mng_c::entry(J3DModelData*, u16, int) {
    nofralloc
#include "d/d_model/asm/func_8009C8D8.s"
}

// __ct__6dMdl_cFv
// dMdl_c::dMdl_c(void)
asm dMdl_c::dMdl_c(void) {
    nofralloc
#include "d/d_model/asm/func_8009C930.s"
}
